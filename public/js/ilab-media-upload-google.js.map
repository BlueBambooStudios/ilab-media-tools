{"version":3,"sources":["ilab-media-upload-google.js"],"names":[],"mappings":"AAAA,2CACA,sBACA,SACA,KACA,iCACA,AACA,AACA,mBACA,QACA,iCACA,KACA,AACA,AACA,oCACA,sBACA,oBACA,AACA,yBACA,QACA,AACA,WACA,OACA,WACA,eACA,oBACA,AACA,yBACA,AACA,6BACA,2BACA,AACA,mBACA,CACA,aACA,MACA,eACA,eACA,qBACA,mBACA,sBACA,MAIA,sCAHA,6BACA,MACA,GAEA,oBACA,gBACA,QACA,gCACA,AACA,AACA,kBACA,gBACA,sBACA,EACA,kBACA,GACA,iBACA,AACA,GACA,kBACA,GACA,iBACA,AACA,GACA,QACA,AACA,iBACA,AACA,EACA,CACA,EACA","file":"ilab-media-upload-google.js","sourcesContent":["var ilabMediaGoogleUploader = function($, item, file) {\n    this.start = function() {\n        var mimeType = file.type;\n        if (mimeType == 'application/x-photoshop') {\n            mimeType = 'image/psd';\n        }\n\n        var data = {\n            \"action\": \"ilab_upload_prepare\",\n            \"filename\": file.name,\n            \"type\": mimeType\n        };\n\n        $.post(ajaxurl, data, function(response){\n            if (response.status == 'ready') {\n                item.updateStatusText('Uploading ...');\n\n                var key = response.key;\n                var acl = response.acl;\n\n                $.ajax({\n                    url: response.url,\n                    method: 'POST',\n                    headers: {\n                        \"x-goog-resumable\": \"start\",\n                        // \"x-goog-acl\": acl,\n                        \"Content-Type\": file.type\n                    },\n                    success: function(response, status, xhr) {\n                        var location = xhr.getResponseHeader('location');\n\n                        $.ajax({\n                            url: location,\n                            method: 'PUT',\n                            processData: false,\n                            crossDomain: true,\n                            data:file,\n                            contentType: file.type,\n                            xhr: function() {\n                                var xhr = $.ajaxSettings.xhr();\n                                xhr.upload.onprogress = function (e) {\n                                    item.updateProgress(e.loaded / e.total);\n                                };\n                                return xhr;\n                            },\n                            success: function(successResponse) {\n                                var importData = {\n                                    \"action\": \"ilab_upload_import_cloud_file\",\n                                    \"key\": key\n                                };\n\n                                $.post(ajaxurl, importData, function(importResponse) {\n                                    item.itemUploaded((importResponse.status == 'success'), importResponse);\n                                });\n                            },\n                            error: function(response) {\n                                item.itemUploadError();\n                            }\n                        });\n                    },\n                    error: function(response) {\n                        item.itemUploadError();\n                    }\n                });\n            } else {\n                item.itemUploadError();\n            }\n        });\n\n    }\n};\n\nilabMediaUploadItem.prototype.storageUploader = ilabMediaGoogleUploader;"],"sourceRoot":"js/"}