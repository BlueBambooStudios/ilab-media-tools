!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function e(t){return"number"==typeof t&&!isNaN(t)}function i(t){return void 0===t}function a(t,i){var a=[];return e(i)&&a.push(i),a.slice.apply(t,a)}function s(t,e){var i=a(arguments,2);return function(){return t.apply(e,i.concat(a(arguments)))}}function n(t){var e=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return e&&(e[1]!==b.protocol||e[2]!==b.hostname||e[3]!==b.port)}function o(t){var e="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+e}function r(t){return t?' crossOrigin="'+t+'"':""}function h(t,e){var i;if(t.naturalWidth&&!T)return e(t.naturalWidth,t.naturalHeight);i=document.createElement("img"),i.onload=function(){e(this.width,this.height)},i.src=t.src}function l(t){var i=[],a=t.rotate,s=t.scaleX,n=t.scaleY;return e(s)&&e(n)&&i.push("scale("+s+","+n+")"),e(a)&&i.push("rotate("+a+"deg)"),i.length?i.join(" "):"none"}function p(t,e){var i,a,s=X(t.degree)%180,n=(s>90?180-s:s)*Math.PI/180,o=Y(n),r=j(n),h=t.width,l=t.height,p=t.aspectRatio;return e?(i=h/(r+o/p),a=i/p):(i=h*r+l*o,a=h*o+l*r),{width:i,height:a}}function c(i,a){var s,n,o,r=t("<canvas>")[0],h=r.getContext("2d"),l=0,c=0,d=a.naturalWidth,u=a.naturalHeight,m=a.rotate,g=a.scaleX,f=a.scaleY,v=e(g)&&e(f)&&(1!==g||1!==f),w=e(m)&&0!==m,x=w||v,b=d*X(g||1),C=u*X(f||1);return v&&(s=b/2,n=C/2),w&&(o=p({width:b,height:C,degree:m}),b=o.width,C=o.height,s=b/2,n=C/2),r.width=b,r.height=C,x&&(l=-d/2,c=-u/2,h.save(),h.translate(s,n)),v&&h.scale(g,f),w&&h.rotate(m*Math.PI/180),h.drawImage(i,E(l),E(c),E(d),E(u)),x&&h.restore(),r}function d(e){var i=e.length,a=0,s=0;return i&&(t.each(e,function(t,e){a+=e.pageX,s+=e.pageY}),a/=i,s/=i),{pageX:a,pageY:s}}function u(t,e,i){var a,s="";for(a=e,i+=e;a<i;a++)s+=A(t.getUint8(a));return s}function m(t){var e,i,a,s,n,o,r,h,l,p,c=new I(t),d=c.byteLength;if(255===c.getUint8(0)&&216===c.getUint8(1))for(l=2;l<d;){if(255===c.getUint8(l)&&225===c.getUint8(l+1)){r=l;break}l++}if(r&&(i=r+4,a=r+10,"Exif"===u(c,i,4)&&(o=c.getUint16(a),((n=18761===o)||19789===o)&&42===c.getUint16(a+2,n)&&(s=c.getUint32(a+4,n))>=8&&(h=a+s))),h)for(d=c.getUint16(h,n),p=0;p<d;p++)if(l=h+12*p+2,274===c.getUint16(l,n)){l+=8,e=c.getUint16(l,n),T&&c.setUint16(l,1,n);break}return e}function g(t){var e,i=t.replace(_,""),a=atob(i),s=a.length,n=new y(s),o=new k(n);for(e=0;e<s;e++)o[e]=a.charCodeAt(e);return n}function f(t){var e,i=new k(t),a=i.length,s="";for(e=0;e<a;e++)s+=A(i[e]);return"data:image/jpeg;base64,"+B(s)}function v(e,i){this.$element=t(e),this.options=t.extend({},v.DEFAULTS,t.isPlainObject(i)&&i),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var w=t(window),x=t(document),b=window.location,C=window.navigator,y=window.ArrayBuffer,k=window.Uint8Array,I=window.DataView,B=window.btoa,D="cropper-hidden",P="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",S=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,$=/^data\:/,_=/^data\:([^\;]+)\;base64,/,M=/^data\:image\/jpeg.*;base64,/,L=t.isFunction(t("<canvas>")[0].getContext),T=C&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(C.userAgent),z=Number,O=Math.min,W=Math.max,X=Math.abs,Y=Math.sin,j=Math.cos,H=Math.sqrt,R=Math.round,E=Math.floor,A=String.fromCharCode;v.prototype={constructor:v,init:function(){var t,e=this.$element;if(e.is("img")){if(this.isImg=!0,this.originalUrl=t=e.attr("src"),!t)return;t=e.prop("src")}else e.is("canvas")&&L&&(t=e[0].toDataURL());this.load(t)},trigger:function(e,i){var a=t.Event(e,i);return this.$element.trigger(a),a},load:function(e){var i,a,s=this.options,r=this.$element;if(e&&(r.one("build.cropper",s.build),!this.trigger("build.cropper").isDefaultPrevented())){if(this.url=e,this.image={},!s.checkOrientation||!y)return this.clone();if(i=t.proxy(this.read,this),$.test(e))return M.test(e)?i(g(e)):this.clone();a=new XMLHttpRequest,a.onerror=a.onabort=t.proxy(function(){this.clone()},this),a.onload=function(){i(this.response)},s.checkCrossOrigin&&n(e)&&r.prop("crossOrigin")&&(e=o(e)),a.open("get",e),a.responseType="arraybuffer",a.send()}},read:function(t){var e,i,a,s=this.options,n=m(t),o=this.image;if(n>1)switch(this.url=f(t),n){case 2:i=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90}s.rotatable&&(o.rotate=e),s.scalable&&(o.scaleX=i,o.scaleY=a),this.clone()},clone:function(){var e,i,a=this.options,s=this.$element,h=this.url,l="";a.checkCrossOrigin&&n(h)&&(l=s.prop("crossOrigin"),l?e=h:(l="anonymous",e=o(h))),this.crossOrigin=l,this.crossOriginUrl=e,this.$clone=i=t("<img"+r(l)+' src="'+(e||h)+'">'),this.isImg?s[0].complete?this.start():s.one("load.cropper",t.proxy(this.start,this)):i.one("load.cropper",t.proxy(this.start,this)).one("error.cropper",t.proxy(this.stop,this)).addClass("cropper-hide").insertAfter(s)},start:function(){var e=this.$element,i=this.$clone;this.isImg||(i.off("error.cropper",this.stop),e=i),h(e[0],t.proxy(function(e,i){t.extend(this.image,{naturalWidth:e,naturalHeight:i,aspectRatio:e/i}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var e,i,a,s=this.options,n=this.$element,o=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=n.parent(),this.$cropper=e=t(v.TEMPLATE),this.$canvas=e.find(".cropper-canvas").append(o),this.$dragBox=e.find(".cropper-drag-box"),this.$cropBox=i=e.find(".cropper-crop-box"),this.$viewBox=e.find(".cropper-view-box"),this.$face=a=i.find(".cropper-face"),n.addClass(D).after(e),this.isImg||o.removeClass("cropper-hide"),this.initPreview(),this.bind(),s.aspectRatio=W(0,s.aspectRatio)||NaN,s.viewMode=W(0,O(3,R(s.viewMode)))||0,s.autoCrop?(this.isCropped=!0,s.modal&&this.$dragBox.addClass("cropper-modal")):i.addClass(D),s.guides||i.find(".cropper-dashed").addClass(D),s.center||i.find(".cropper-center").addClass(D),s.cropBoxMovable&&a.addClass("cropper-move").data("action","all"),s.highlight||a.addClass("cropper-invisible"),s.background&&e.addClass("cropper-bg"),s.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(D),this.setDragMode(s.dragMode),this.render(),this.isBuilt=!0,this.setData(s.data),n.one("built.cropper",s.built),setTimeout(t.proxy(function(){this.trigger("built.cropper"),this.trigger("crop.cropper",this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,e=this.$element,i=this.$container,a=this.$cropper;a.addClass(D),e.removeClass(D),a.css(this.container={width:W(i.width(),z(t.minContainerWidth)||200),height:W(i.height(),z(t.minContainerHeight)||100)}),e.addClass(D),a.removeClass(D)},initCanvas:function(){var e,i=this.options.viewMode,a=this.container,s=a.width,n=a.height,o=this.image,r=o.naturalWidth,h=o.naturalHeight,l=90===X(o.rotate),p=l?h:r,c=l?r:h,d=p/c,u=s,m=n;n*d>s?3===i?u=n*d:m=s/d:3===i?m=s/d:u=n*d,e={naturalWidth:p,naturalHeight:c,aspectRatio:d,width:u,height:m},e.oldLeft=e.left=(s-u)/2,e.oldTop=e.top=(n-m)/2,this.canvas=e,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=t.extend({},o),this.initialCanvas=t.extend({},e)},limitCanvas:function(t,e){var i,a,s,n,o=this.options,r=o.viewMode,h=this.container,l=h.width,p=h.height,c=this.canvas,d=c.aspectRatio,u=this.cropBox,m=this.isCropped&&u;t&&(i=z(o.minCanvasWidth)||0,a=z(o.minCanvasHeight)||0,r&&(r>1?(i=W(i,l),a=W(a,p),3===r&&(a*d>i?i=a*d:a=i/d)):i?i=W(i,m?u.width:0):a?a=W(a,m?u.height:0):m&&(i=u.width,a=u.height,a*d>i?i=a*d:a=i/d)),i&&a?a*d>i?a=i/d:i=a*d:i?a=i/d:a&&(i=a*d),c.minWidth=i,c.minHeight=a,c.maxWidth=1/0,c.maxHeight=1/0),e&&(r?(s=l-c.width,n=p-c.height,c.minLeft=O(0,s),c.minTop=O(0,n),c.maxLeft=W(0,s),c.maxTop=W(0,n),m&&this.isLimited&&(c.minLeft=O(u.left,u.left+u.width-c.width),c.minTop=O(u.top,u.top+u.height-c.height),c.maxLeft=u.left,c.maxTop=u.top,2===r&&(c.width>=l&&(c.minLeft=O(0,s),c.maxLeft=W(0,s)),c.height>=p&&(c.minTop=O(0,n),c.maxTop=W(0,n))))):(c.minLeft=-c.width,c.minTop=-c.height,c.maxLeft=l,c.maxTop=p))},renderCanvas:function(t){var e,i,a=this.canvas,s=this.image,n=s.rotate,o=s.naturalWidth,r=s.naturalHeight;this.isRotated&&(this.isRotated=!1,i=p({width:s.width,height:s.height,degree:n}),(e=i.width/i.height)!==a.aspectRatio&&(a.left-=(i.width-a.width)/2,a.top-=(i.height-a.height)/2,a.width=i.width,a.height=i.height,a.aspectRatio=e,a.naturalWidth=o,a.naturalHeight=r,n%180&&(i=p({width:o,height:r,degree:n}),a.naturalWidth=i.width,a.naturalHeight=i.height),this.limitCanvas(!0,!1))),(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=O(W(a.width,a.minWidth),a.maxWidth),a.height=O(W(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.oldLeft=a.left=O(W(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=O(W(a.top,a.minTop),a.maxTop),this.$canvas.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(e){var i,a=this.canvas,s=this.image;s.rotate&&(i=p({width:a.width,height:a.height,degree:s.rotate,aspectRatio:s.aspectRatio},!0)),t.extend(s,i?{width:i.width,height:i.height,left:(a.width-i.width)/2,top:(a.height-i.height)/2}:{width:a.width,height:a.height,left:0,top:0}),this.$clone.css({width:s.width,height:s.height,marginLeft:s.left,marginTop:s.top,transform:l(s)}),e&&this.output()},initCropBox:function(){var e=this.options,i=this.canvas,a=e.aspectRatio,s=z(e.autoCropArea)||.8,n={width:i.width,height:i.height};a&&(i.height*a>i.width?n.height=n.width/a:n.width=n.height*a),this.cropBox=n,this.limitCropBox(!0,!0),n.width=O(W(n.width,n.minWidth),n.maxWidth),n.height=O(W(n.height,n.minHeight),n.maxHeight),n.width=W(n.minWidth,n.width*s),n.height=W(n.minHeight,n.height*s),n.oldLeft=n.left=i.left+(i.width-n.width)/2,n.oldTop=n.top=i.top+(i.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,e){var i,a,s,n,o=this.options,r=o.aspectRatio,h=this.container,l=h.width,p=h.height,c=this.canvas,d=this.cropBox,u=this.isLimited;t&&(i=z(o.minCropBoxWidth)||0,a=z(o.minCropBoxHeight)||0,i=O(i,l),a=O(a,p),s=O(l,u?c.width:l),n=O(p,u?c.height:p),r&&(i&&a?a*r>i?a=i/r:i=a*r:i?a=i/r:a&&(i=a*r),n*r>s?n=s/r:s=n*r),d.minWidth=O(i,s),d.minHeight=O(a,n),d.maxWidth=s,d.maxHeight=n),e&&(u?(d.minLeft=W(0,c.left),d.minTop=W(0,c.top),d.maxLeft=O(l,c.left+c.width)-d.width,d.maxTop=O(p,c.top+c.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=l-d.width,d.maxTop=p-d.height))},renderCropBox:function(){var t=this.options,e=this.container,i=e.width,a=e.height,s=this.cropBox;(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=O(W(s.width,s.minWidth),s.maxWidth),s.height=O(W(s.height,s.minHeight),s.maxHeight),this.limitCropBox(!1,!0),s.oldLeft=s.left=O(W(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=O(W(s.top,s.minTop),s.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data("action",s.width===i&&s.height===a?"move":"all"),this.$cropBox.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger("crop.cropper",this.getData())},initPreview:function(){var e,i=r(this.crossOrigin),a=i?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=e=t("<img"+i+' src="'+a+'">'),this.$viewBox.html(e),this.$preview.each(function(){var e=t(this);e.data("preview",{width:e.width(),height:e.height(),html:e.html()}),e.html("<img"+i+' src="'+a+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var e=t(this),i=e.data("preview");e.css({width:i.width,height:i.height}).html(i.html).removeData("preview")})},preview:function(){var e=this.image,i=this.canvas,a=this.cropBox,s=a.width,n=a.height,o=e.width,r=e.height,h=a.left-i.left-e.left,p=a.top-i.top-e.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:o,height:r,marginLeft:-h,marginTop:-p,transform:l(e)}),this.$preview.each(function(){var i=t(this),a=i.data("preview"),c=a.width,d=a.height,u=c,m=d,g=1;s&&(g=c/s,m=n*g),n&&m>d&&(g=d/n,u=s*g,m=d),i.css({width:u,height:m}).find("img").css({width:o*g,height:r*g,marginLeft:-h*g,marginTop:-p*g,transform:l(e)})}))},bind:function(){var e=this.options,i=this.$element,a=this.$cropper;t.isFunction(e.cropstart)&&i.on("cropstart.cropper",e.cropstart),t.isFunction(e.cropmove)&&i.on("cropmove.cropper",e.cropmove),t.isFunction(e.cropend)&&i.on("cropend.cropper",e.cropend),t.isFunction(e.crop)&&i.on("crop.cropper",e.crop),t.isFunction(e.zoom)&&i.on("zoom.cropper",e.zoom),a.on("mousedown touchstart pointerdown MSPointerDown",t.proxy(this.cropStart,this)),e.zoomable&&e.zoomOnWheel&&a.on("wheel mousewheel DOMMouseScroll",t.proxy(this.wheel,this)),e.toggleDragModeOnDblclick&&a.on("dblclick",t.proxy(this.dblclick,this)),x.on("mousemove touchmove pointermove MSPointerMove",this._cropMove=s(this.cropMove,this)).on(P,this._cropEnd=s(this.cropEnd,this)),e.responsive&&w.on("resize.cropper",this._resize=s(this.resize,this))},unbind:function(){var e=this.options,i=this.$element,a=this.$cropper;t.isFunction(e.cropstart)&&i.off("cropstart.cropper",e.cropstart),t.isFunction(e.cropmove)&&i.off("cropmove.cropper",e.cropmove),t.isFunction(e.cropend)&&i.off("cropend.cropper",e.cropend),t.isFunction(e.crop)&&i.off("crop.cropper",e.crop),t.isFunction(e.zoom)&&i.off("zoom.cropper",e.zoom),a.off("mousedown touchstart pointerdown MSPointerDown",this.cropStart),e.zoomable&&e.zoomOnWheel&&a.off("wheel mousewheel DOMMouseScroll",this.wheel),e.toggleDragModeOnDblclick&&a.off("dblclick",this.dblclick),x.off("mousemove touchmove pointermove MSPointerMove",this._cropMove).off(P,this._cropEnd),e.responsive&&w.off("resize.cropper",this._resize)},resize:function(){var e,i,a,s=this.options.restore,n=this.$container,o=this.container;!this.isDisabled&&o&&(1===(a=n.width()/o.width)&&n.height()===o.height||(s&&(e=this.getCanvasData(),i=this.getCropBoxData()),this.render(),s&&(this.setCanvasData(t.each(e,function(t,i){e[t]=i*a})),this.setCropBoxData(t.each(i,function(t,e){i[t]=e*a})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass("cropper-crop")?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(e){var i=e.originalEvent||e,a=z(this.options.wheelZoomRatio)||.1,s=1;this.isDisabled||(e.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),i.deltaY?s=i.deltaY>0?1:-1:i.wheelDelta?s=-i.wheelDelta/120:i.detail&&(s=i.detail>0?1:-1),this.zoom(-s*a,e)))},cropStart:function(e){var i,a,s=this.options,n=e.originalEvent,o=n&&n.touches,r=e;if(!this.isDisabled){if(o){if((i=o.length)>1){if(!s.zoomable||!s.zoomOnTouch||2!==i)return;r=o[1],this.startX2=r.pageX,this.startY2=r.pageY,a="zoom"}r=o[0]}if(a=a||t(r.target).data("action"),S.test(a)){if(this.trigger("cropstart.cropper",{originalEvent:n,action:a}).isDefaultPrevented())return;e.preventDefault(),this.action=a,this.cropping=!1,this.startX=r.pageX||n&&n.pageX,this.startY=r.pageY||n&&n.pageY,"crop"===a&&(this.cropping=!0,this.$dragBox.addClass("cropper-modal"))}}},cropMove:function(t){var e,i=this.options,a=t.originalEvent,s=a&&a.touches,n=t,o=this.action;if(!this.isDisabled){if(s){if((e=s.length)>1){if(!i.zoomable||!i.zoomOnTouch||2!==e)return;n=s[1],this.endX2=n.pageX,this.endY2=n.pageY}n=s[0]}if(o){if(this.trigger("cropmove.cropper",{originalEvent:a,action:o}).isDefaultPrevented())return;t.preventDefault(),this.endX=n.pageX||a&&a.pageX,this.endY=n.pageY||a&&a.pageY,this.change(n.shiftKey,"zoom"===o?t:null)}}},cropEnd:function(t){var e=t.originalEvent,i=this.action;this.isDisabled||i&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass("cropper-modal",this.isCropped&&this.options.modal)),this.action="",this.trigger("cropend.cropper",{originalEvent:e,action:i}))},change:function(t,e){var i,a,s=this.options,n=s.aspectRatio,o=this.action,r=this.container,h=this.canvas,l=this.cropBox,p=l.width,c=l.height,d=l.left,u=l.top,m=d+p,g=u+c,f=0,v=0,w=r.width,x=r.height,b=!0;switch(!n&&t&&(n=p&&c?p/c:1),this.isLimited&&(f=l.minLeft,v=l.minTop,w=f+O(r.width,h.left+h.width),x=v+O(r.height,h.top+h.height)),a={x:this.endX-this.startX,y:this.endY-this.startY},n&&(a.X=a.y*n,a.Y=a.x/n),o){case"all":d+=a.x,u+=a.y;break;case"e":if(a.x>=0&&(m>=w||n&&(u<=v||g>=x))){b=!1;break}p+=a.x,n&&(c=p/n,u-=a.Y/2),p<0&&(o="w",p=0);break;case"n":if(a.y<=0&&(u<=v||n&&(d<=f||m>=w))){b=!1;break}c-=a.y,u+=a.y,n&&(p=c*n,d+=a.X/2),c<0&&(o="s",c=0);break;case"w":if(a.x<=0&&(d<=f||n&&(u<=v||g>=x))){b=!1;break}p-=a.x,d+=a.x,n&&(c=p/n,u+=a.Y/2),p<0&&(o="e",p=0);break;case"s":if(a.y>=0&&(g>=x||n&&(d<=f||m>=w))){b=!1;break}c+=a.y,n&&(p=c*n,d-=a.X/2),c<0&&(o="n",c=0);break;case"ne":if(n){if(a.y<=0&&(u<=v||m>=w)){b=!1;break}c-=a.y,u+=a.y,p=c*n}else a.x>=0?m<w?p+=a.x:a.y<=0&&u<=v&&(b=!1):p+=a.x,a.y<=0?u>v&&(c-=a.y,u+=a.y):(c-=a.y,u+=a.y);p<0&&c<0?(o="sw",c=0,p=0):p<0?(o="nw",p=0):c<0&&(o="se",c=0);break;case"nw":if(n){if(a.y<=0&&(u<=v||d<=f)){b=!1;break}c-=a.y,u+=a.y,p=c*n,d+=a.X}else a.x<=0?d>f?(p-=a.x,d+=a.x):a.y<=0&&u<=v&&(b=!1):(p-=a.x,d+=a.x),a.y<=0?u>v&&(c-=a.y,u+=a.y):(c-=a.y,u+=a.y);p<0&&c<0?(o="se",c=0,p=0):p<0?(o="ne",p=0):c<0&&(o="sw",c=0);break;case"sw":if(n){if(a.x<=0&&(d<=f||g>=x)){b=!1;break}p-=a.x,d+=a.x,c=p/n}else a.x<=0?d>f?(p-=a.x,d+=a.x):a.y>=0&&g>=x&&(b=!1):(p-=a.x,d+=a.x),a.y>=0?g<x&&(c+=a.y):c+=a.y;p<0&&c<0?(o="ne",c=0,p=0):p<0?(o="se",p=0):c<0&&(o="nw",c=0);break;case"se":if(n){if(a.x>=0&&(m>=w||g>=x)){b=!1;break}p+=a.x,c=p/n}else a.x>=0?m<w?p+=a.x:a.y>=0&&g>=x&&(b=!1):p+=a.x,a.y>=0?g<x&&(c+=a.y):c+=a.y;p<0&&c<0?(o="nw",c=0,p=0):p<0?(o="sw",p=0):c<0&&(o="ne",c=0);break;case"move":this.move(a.x,a.y),b=!1;break;case"zoom":this.zoom(function(t,e,i,a){var s=H(t*t+e*e);return(H(i*i+a*a)-s)/s}(X(this.startX-this.startX2),X(this.startY-this.startY2),X(this.endX-this.endX2),X(this.endY-this.endY2)),e),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case"crop":if(!a.x||!a.y){b=!1;break}i=this.$cropper.offset(),d=this.startX-i.left,u=this.startY-i.top,p=l.minWidth,c=l.minHeight,a.x>0?o=a.y>0?"se":"ne":a.x<0&&(d-=p,o=a.y>0?"sw":"nw"),a.y<0&&(u-=c),this.isCropped||(this.$cropBox.removeClass(D),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}b&&(l.width=p,l.height=c,l.left=d,l.top=u,this.action=o,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass("cropper-modal"),this.$cropBox.removeClass(D)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass("cropper-modal"),this.$cropBox.addClass(D))},replace:function(t,e){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),e?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(D)):this.isImg?t.off("load.cropper",this.start):this.$clone&&this.$clone.remove(),t.removeData("cropper")},move:function(t,e){var a=this.canvas;this.moveTo(i(t)?t:a.left+z(t),i(e)?e:a.top+z(e))},moveTo:function(t,a){var s=this.canvas,n=!1;i(a)&&(a=t),t=z(t),a=z(a),this.isBuilt&&!this.isDisabled&&this.options.movable&&(e(t)&&(s.left=t,n=!0),e(a)&&(s.top=a,n=!0),n&&this.renderCanvas(!0))},zoom:function(t,e){var i=this.canvas;t=z(t),t=t<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,e)},zoomTo:function(t,e){var i,a,s,n,o,r=this.options,h=this.canvas,l=h.width,p=h.height,c=h.naturalWidth,u=h.naturalHeight;if((t=z(t))>=0&&this.isBuilt&&!this.isDisabled&&r.zoomable){if(a=c*t,s=u*t,e&&(i=e.originalEvent),this.trigger("zoom.cropper",{originalEvent:i,oldRatio:l/c,ratio:a/c}).isDefaultPrevented())return;i?(n=this.$cropper.offset(),o=i.touches?d(i.touches):{pageX:e.pageX||i.pageX||0,pageY:e.pageY||i.pageY||0},h.left-=(a-l)*((o.pageX-n.left-h.left)/l),h.top-=(s-p)*((o.pageY-n.top-h.top)/p)):(h.left-=(a-l)/2,h.top-=(s-p)/2),h.width=a,h.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+z(t))},rotateTo:function(t){t=z(t),e(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,a){var s=this.image,n=!1;i(a)&&(a=t),t=z(t),a=z(a),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(e(t)&&(s.scaleX=t,n=!0),e(a)&&(s.scaleY=a,n=!0),n&&this.renderImage(!0))},scaleX:function(t){var i=this.image.scaleY;this.scale(t,e(i)?i:1)},scaleY:function(t){var i=this.image.scaleX;this.scale(e(i)?i:1,t)},getData:function(e){var i,a,s=this.options,n=this.image,o=this.canvas,r=this.cropBox;return this.isBuilt&&this.isCropped?(a={x:r.left-o.left,y:r.top-o.top,width:r.width,height:r.height},i=n.width/n.naturalWidth,t.each(a,function(t,s){s/=i,a[t]=e?R(s):s})):a={x:0,y:0,width:0,height:0},s.rotatable&&(a.rotate=n.rotate||0),s.scalable&&(a.scaleX=n.scaleX||1,a.scaleY=n.scaleY||1),a},setData:function(i){var a,s,n,o=this.options,r=this.image,h=this.canvas,l={};t.isFunction(i)&&(i=i.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(i)&&(o.rotatable&&e(i.rotate)&&i.rotate!==r.rotate&&(r.rotate=i.rotate,this.isRotated=a=!0),o.scalable&&(e(i.scaleX)&&i.scaleX!==r.scaleX&&(r.scaleX=i.scaleX,s=!0),e(i.scaleY)&&i.scaleY!==r.scaleY&&(r.scaleY=i.scaleY,s=!0)),a?this.renderCanvas():s&&this.renderImage(),n=r.width/r.naturalWidth,e(i.x)&&(l.left=i.x*n+h.left),e(i.y)&&(l.top=i.y*n+h.top),e(i.width)&&(l.width=i.width*n),e(i.height)&&(l.height=i.height*n),this.setCropBoxData(l))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var e=this.canvas,i={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,a){i[a]=e[a]}),i},setCanvasData:function(i){var a=this.canvas,s=a.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(i)&&(e(i.left)&&(a.left=i.left),e(i.top)&&(a.top=i.top),e(i.width)?(a.width=i.width,a.height=i.width/s):e(i.height)&&(a.height=i.height,a.width=i.height*s),this.renderCanvas(!0))},getCropBoxData:function(){var t,e=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(i){var a,s,n=this.cropBox,o=this.options.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(i)&&(e(i.left)&&(n.left=i.left),e(i.top)&&(n.top=i.top),e(i.width)&&(a=!0,n.width=i.width),e(i.height)&&(s=!0,n.height=i.height),o&&(a?n.height=n.width/o:s&&(n.width=n.height*o)),this.renderCropBox())},getCroppedCanvas:function(e){var i,a,s,n,o,r,h,l,p,d,u;if(this.isBuilt&&L)return this.isCropped?(t.isPlainObject(e)||(e={}),u=this.getData(),i=u.width,a=u.height,l=i/a,t.isPlainObject(e)&&(o=e.width,r=e.height,o?(r=o/l,h=o/i):r&&(o=r*l,h=r/a)),s=E(o||i),n=E(r||a),p=t("<canvas>")[0],p.width=s,p.height=n,d=p.getContext("2d"),e.fillColor&&(d.fillStyle=e.fillColor,d.fillRect(0,0,s,n)),d.drawImage.apply(d,function(){var t,e,s,n,o,r,l=c(this.$clone[0],this.image),p=l.width,d=l.height,m=this.canvas,g=[l],f=u.x+m.naturalWidth*(X(u.scaleX||1)-1)/2,v=u.y+m.naturalHeight*(X(u.scaleY||1)-1)/2;return f<=-i||f>p?f=t=s=o=0:f<=0?(s=-f,f=0,t=o=O(p,i+f)):f<=p&&(s=0,t=o=O(i,p-f)),t<=0||v<=-a||v>d?v=e=n=r=0:v<=0?(n=-v,v=0,e=r=O(d,a+v)):v<=d&&(n=0,e=r=O(a,d-v)),g.push(E(f),E(v),E(t),E(e)),h&&(s*=h,n*=h,o*=h,r*=h),o>0&&r>0&&g.push(E(s),E(n),E(o),E(r)),g}.call(this)),p):c(this.$clone[0],this.image)},setAspectRatio:function(t){var e=this.options;this.isDisabled||i(t)||(e.aspectRatio=W(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var e,i,a=this.options;this.isLoaded&&!this.isDisabled&&(e="crop"===t,i=a.movable&&"move"===t,t=e||i?t:"none",this.$dragBox.data("action",t).toggleClass("cropper-crop",e).toggleClass("cropper-move",i),a.cropBoxMovable||this.$face.data("action",t).toggleClass("cropper-crop",e).toggleClass("cropper-move",i))}},v.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},v.setDefaults=function(e){t.extend(v.DEFAULTS,e)},v.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',v.other=t.fn.cropper,t.fn.cropper=function(e){var s,n=a(arguments,1);return this.each(function(){var i,a,o=t(this),r=o.data("cropper");if(!r){if(/destroy/.test(e))return;i=t.extend({},o.data(),t.isPlainObject(e)&&e),o.data("cropper",r=new v(this,i))}"string"==typeof e&&t.isFunction(a=r[e])&&(s=a.apply(r,n))}),i(s)?this:s},t.fn.cropper.Constructor=v,t.fn.cropper.setDefaults=v.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=v.other,this}});var ILabCrop=function(t,e){this.settings=e,this.modalContainer=t("#ilabm-container-"+e.modal_id),this.cropper=this.modalContainer.find(".ilabc-cropper"),this.cropperData={},this.modal_id=e.modal_id;var i,a=this,s=!1;this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:this.settings.size,tabSelected:function(t){ILabModal.loadURL(t.data("url"),!0,function(t){a.bindUI(t)})}}),t(window).resize(function(){s||(data=a.cropper.cropper("getData"),a.settings.prev_crop_x=data.x,a.settings.prev_crop_y=data.y,a.settings.prev_crop_width=data.width,a.settings.prev_crop_height=data.height),s=!0,a.updatePreviewWidth(),clearTimeout(i),i=setTimeout(a._resized,250)}),this.modalContainer.find(".ilabc-button-crop").on("click",function(t){return t.preventDefault(),a.crop(),!1}),this._resized=function(){a.bindUI(a.settings),s=!1},this.updatePreviewWidth=function(){var t=this.modalContainer.find(".ilab-crop-preview-title").width();this.modalContainer.find(".ilab-crop-preview").css({height:t/a.settings.aspect_ratio+"px",width:t+"px"})},this.bindUI=function(t){this.settings=t,this.cropper.cropper("destroy"),this.cropper.off("built.cropper"),t.hasOwnProperty("cropped_src")&&null!==t.cropped_src&&this.modalContainer.find(".ilab-current-crop-img").attr("src",t.cropped_src),t.hasOwnProperty("size_title")&&null!==t.size_title&&this.modalContainer.find(".ilabc-crop-size-title").text("Current "+t.size_title+" ("+t.min_width+" x "+t.min_height+")"),void 0!==t.aspect_ratio&&(this.updatePreviewWidth(),void 0!==t.prev_crop_x&&null!==t.prev_crop_x&&(this.cropperData={x:t.prev_crop_x,y:t.prev_crop_y,width:t.prev_crop_width,height:t.prev_crop_height}),this.cropper.on("built.cropper",function(){a.updatePreviewWidth()}).on("crop.cropper",function(t){}).cropper({viewMode:1,aspectRatio:t.aspect_ratio,minWidth:t.min_width,minHeight:t.min_height,modal:!0,zoomable:!1,mouseWheelZoom:!1,dragCrop:!1,autoCropArea:1,movable:!1,data:this.cropperData,checkImageOrigin:!1,checkCrossOrigin:!1,responsive:!0,preview:"#ilabm-container-"+this.modal_id+" .ilab-crop-preview"}))},this.crop=function(){var t=this;this.displayStatus("Saving crop ...");var e=this.cropper.cropper("getData");e.action="ilab_perform_crop",e.post=this.settings.image_id,e.size=this.settings.size,jQuery.post(ajaxurl,e,function(e){"ok"==e.status?(t.modalContainer.find(".ilab-current-crop-img").one("load",function(){t.hideStatus()}),t.modalContainer.find(".ilab-current-crop-img").attr("src",e.src)):t.hideStatus()})},this.displayStatus=function(t){a.modalContainer.find(".ilabm-status-label").text(t),a.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){a.modalContainer.find(".ilabm-status-container").addClass("is-hidden")},this.bindUI(e)},ImgixComponents=function(){return{utilities:{byteToHex:function(t){var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return e[t>>4&15]+e[15&t]}}}}();!function(t){t.fn.imgixLabel=function(e){var i=t.extend({},e);return this.each(function(){var e,a=t(this),s=0,n=t('<input type="text" class="imgix-label-editor is-hidden" pattern="[0-9-]+">');a.parent().append(n),n.on("keydown",function(t){if(27==t.keyCode)n.off("blur"),n.off("input"),n.addClass("is-hidden"),i.hasOwnProperty("changed")&&i.changed(s),a.text(s);else if(13==t.keyCode){n.off("blur"),n.off("input");var e=parseInt(n.val());n.addClass("is-hidden"),i.hasOwnProperty("changed")&&i.changed(e),a.text(e)}else if(38==t.keyCode){var e=parseInt(n.val());e++,n.val(e),i.hasOwnProperty("changed")&&i.changed(e),a.text(e)}else{if(40!=t.keyCode)return t.keyCode<57||(t.keyCode>90&&t.keyCode<105||(109==t.keyCode||(!!t.metaKey||(t.preventDefault(),!1))));var e=parseInt(n.val());e--,n.val(e),i.hasOwnProperty("changed")&&i.changed(e),a.text(e)}}),a.on("click",function(t){return t.preventDefault(),n.on("input",function(){var t=parseInt(n.val())
;i.hasOwnProperty("changed")&&(clearTimeout(e),e=setTimeout(function(){i.changed(t)},500)),a.text(t)}),n.on("blur",function(){var t=parseInt(n.val());n.addClass("is-hidden"),i.hasOwnProperty("changed")&&i.changed(t),a.text(t)}),s=i.hasOwnProperty("currentValue")?i.currentValue():0,n.val(s),n.removeClass("is-hidden"),n.select(),n.focus(),!1})})}}(jQuery),function(t){ImgixComponents.ImgixSlider=function(t,e){this.delegate=t,this.container=e,this.valueLabel=e.find(".imgix-param-title-right > h3"),this.slider=e.find(".imgix-param"),this.resetButton=e.find(".imgix-param-reset"),this.defaultValue=e.data("default-value"),this.param=e.data("param");var i=this;this.container.find(".imgix-param-label").imgixLabel({currentValue:function(){return i.slider.val()},changed:function(t){t!=i.slider.val()&&(i.slider.val(t),i.slider.hide().show(0),i.delegate.preview())}}),this.resetButton.on("click",function(){i.reset()}),this.slider.on("input",function(){i.valueLabel.text(i.slider.val())}),this.slider.on("change",function(){i.valueLabel.text(i.slider.val()),i.delegate.preview()})},ImgixComponents.ImgixSlider.prototype.destroy=function(){this.slider.off("input"),this.slider.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixSlider.prototype.reset=function(t){var e;e=t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,this.valueLabel.text(e),this.slider.val(e),this.slider.hide().show(0),this.delegate.preview()},ImgixComponents.ImgixSlider.prototype.saveValue=function(t){return this.slider.val()!=this.defaultValue&&(t[this.param]=this.slider.val()),t}}(jQuery),function(t){ImgixComponents.ImgixColor=function(t,e){this.delegate=t,this.container=e,this.colorPicker=e.find(".imgix-param-color"),this.alphaSlider=e.find(".imgix-param-alpha"),this.type=e.data("param-type"),this.resetButton=e.find(".imgix-param-reset"),this.param=e.data("param"),this.defaultValue=e.data("default-value");var i=this;if("blend-color"==this.type){this.blendParam=e.data("blend-param"),this.blendSelect=e.find(".imgix-param-blend");var a=e.data("blend-value");this.blendSelect.val(a),this.blendSelect.on("change",function(){i.delegate.preview()})}this.colorPicker.wpColorPicker({palettes:!1,change:function(t,e){i.delegate.preview()}}),this.alphaSlider.on("change",function(){i.delegate.preview()}),this.resetButton.on("click",function(){i.reset()})},ImgixComponents.ImgixColor.prototype.destroy=function(){this.alphaSlider.off("change"),"blend-color"==this.type&&this.blendSelect.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixColor.prototype.reset=function(t){var e,i="none";if(void 0!==t&&t.hasOwnProperty(this.blendParam)&&(i=t[this.blendParam]),e=void 0!==t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,e=e.replace("#",""),8==e.length){var a=parseInt("0x"+e.substring(0,2))/255*100;e=e.substring(2),this.alphaSlider.val(Math.round(a)),this.alphaSlider.hide().show(0)}else this.alphaSlider.val(0),this.alphaSlider.hide().show(0);this.colorPicker.val("#"+e),this.colorPicker.wpColorPicker("color","#"+e),"blend-color"==this.type&&this.blendSelect.val(i),this.delegate.preview()},ImgixComponents.ImgixColor.prototype.saveValue=function(t){return this.alphaSlider.val()>0&&(t[this.param]="#"+ImgixComponents.utilities.byteToHex(Math.round(parseFloat(this.alphaSlider.val())/100*255))+this.colorPicker.val().replace("#",""),"blend-color"==this.type&&"none"!=this.blendSelect.val()&&(t[this.blendParam]=this.blendSelect.val())),t}}(jQuery),function(t){ImgixComponents.ImgixAlignment=function(e,i){this.delegate=e,this.container=i,this.alignmentParam=i.find(".imgix-param"),this.resetButton=i.find(".imgix-param-reset"),this.defaultValue=i.data("default-value"),this.param=i.data("param");var a=this;this.resetButton.on("click",function(){a.reset()}),i.find(".imgix-alignment-button").on("click",function(){var e=t(this);a.container.find(".imgix-alignment-button").each(function(){t(this).removeClass("selected-alignment")}),e.addClass("selected-alignment"),a.alignmentParam.val(e.data("param-value")),a.delegate.preview()})},ImgixComponents.ImgixAlignment.prototype.destroy=function(){this.resetButton.off("click"),this.container.find(".imgix-alignment-button").off("click")},ImgixComponents.ImgixAlignment.prototype.reset=function(e){var i;i=e&&e.hasOwnProperty(this.param)?e[this.param]:this.defaultValue,""==i&&(i=this.defaultValue),this.container.find(".imgix-alignment-button").each(function(){var e=t(this);e.data("param-value")==i?e.addClass("selected-alignment"):e.removeClass("selected-alignment")}),this.alignmentParam.val(i),this.delegate.preview()},ImgixComponents.ImgixAlignment.prototype.saveValue=function(t){return this.alignmentParam.val()!=this.defaultValue&&(t[this.param]=this.alignmentParam.val()),t}}(jQuery),function(t){ImgixComponents.ImgixMediaChooser=function(t,e){this.delegate=t,this.container=e,this.preview=e.find(".imgix-media-preview img"),this.mediaInput=e.find(".imgix-param"),this.selectButton=e.find(".imgix-media-button"),this.resetButton=e.find(".imgix-param-reset"),this.defaultValue=e.data("default-value"),this.param=e.data("param"),this.uploader=wp.media({title:"Select Watermark",button:{text:"Select Watermark"},multiple:!1});var i=this;this.resetButton.on("click",function(){i.reset()}),this.uploader.on("select",function(){attachment=i.uploader.state().get("selection").first().toJSON(),i.mediaInput.val(attachment.id),i.preview.attr("src",attachment.url),i.delegate.preview()}),this.selectButton.on("click",function(t){return t.preventDefault(),i.uploader.open(),!1})},ImgixComponents.ImgixMediaChooser.prototype.destroy=function(){this.selectButton.off("click"),this.uploader.off("select"),this.resetButton.off("click")},ImgixComponents.ImgixMediaChooser.prototype.reset=function(t){var e;t&&t.hasOwnProperty(this.param)?(e=t[this.param],this.mediaInput.val(e)):this.mediaInput.val(""),t&&t.hasOwnProperty(this.param+"_url")?this.preview.attr("src",t[this.param+"_url"]):(this.preview.removeAttr("src").replaceWith(this.preview.clone()),this.preview=this.container.find(".imgix-media-preview img")),this.delegate.preview()},ImgixComponents.ImgixMediaChooser.prototype.saveValue=function(t){var e=this.mediaInput.val();return e&&""!=e&&(t[this.param]=e),t}}(jQuery),function(t){ImgixComponents.ImgixPillbox=function(e,i){this.delegate=e,this.container=i,this.param=i.data("param"),this.values=i.data("param-values").split(","),this.buttons=i.find(".ilabm-pill"),this.inputs={};var a=this;this.buttons.each(function(){var e=t(this),i=e.data("param");a.inputs[i]=a.container.find("input[name='"+i+"']"),e.on("click",function(t){return t.preventDefault(),0==a.inputs[i].val()?(a.inputs[i].val(1),e.addClass("pill-selected")):(a.inputs[i].val(0),e.removeClass("pill-selected")),a.delegate.preview(),!1})})},ImgixComponents.ImgixPillbox.prototype.destroy=function(){this.buttons.off("click")},ImgixComponents.ImgixPillbox.prototype.reset=function(e){this.buttons.each(function(){t(this).removeClass("pill-selected")});var i=this;if(Object.keys(this.inputs).forEach(function(t,e){i.inputs[t].val(0)}),e&&e.hasOwnProperty(this.param)){e[this.param].split(",").forEach(function(t,e){i.inputs[t].val(1),i.container.find("imgix-pill-"+t).addClass("pill-selected")})}this.delegate.preview()},ImgixComponents.ImgixPillbox.prototype.saveValue=function(t){var e=[],i=this;return Object.keys(this.inputs).forEach(function(t,a){1==i.inputs[t].val()&&e.push(t)}),e.length>0&&(t[this.param]=e.join(",")),t}}(jQuery);var ILabImgixPresets=function(t,e,i){this.delegate=e,this.container=i.find(".ilabm-bottom-bar"),this.presetSelect=this.container.find(".imgix-presets"),this.presetContainer=this.container.find(".imgix-preset-container"),this.presetDefaultCheckbox=this.container.find(".imgix-preset-make-default");var a=this;a.presetSelect.on("change",function(){if(0==a.presetSelect.val)return a.delegate.resetAll(),void a.presetDefaultCheckbox.prop("checked",!1);var t=a.delegate.settings.presets[a.presetSelect.val()];t.default_for==a.delegate.settings.size&&a.presetDefaultCheckbox.prop("checked",!0),a.delegate.bindPreset(t)}),this.container.find(".imgix-new-preset-button").on("click",function(){a.newPreset()}),this.container.find(".imgix-save-preset-button").on("click",function(){a.savePreset()}),this.container.find(".imgix-delete-preset-button").on("click",function(){a.deletePreset()}),this.init=function(){a.presetSelect.find("option").remove(),0==Object.keys(a.delegate.settings.presets).length?a.presetContainer.addClass("is-hidden"):(Object.keys(a.delegate.settings.presets).forEach(function(e,i){a.presetSelect.append(t("<option></option>").attr("value","0").text("None")),a.presetSelect.append(t("<option></option>").attr("value",e).text(a.delegate.settings.presets[e].title))}),a.presetContainer.removeClass("is-hidden"),a.presetSelect.val(a.delegate.settings.currentPreset))},this.clearSelected=function(){a.presetSelect.val(0),a.presetDefaultCheckbox.prop("checked",!1)},this.setCurrentPreset=function(t,e){e?a.presetDefaultCheckbox.prop("checked",!0):a.presetDefaultCheckbox.prop("checked",!1),a.presetSelect.val(t)},this.newPreset=function(){var t=prompt("New preset name");if(null!=t){a.delegate.displayStatus("Saving preset ...");var e={};e.name=t,a.presetDefaultCheckbox.is(":checked")&&(e.make_default=1),a.delegate.postAjax("ilab_imgix_new_preset",e,function(t){a.delegate.hideStatus(),"ok"==t.status&&(a.delegate.settings.currentPreset=t.currentPreset,a.delegate.settings.presets=t.presets,a.init())})}},this.savePreset=function(){if(null!=a.presetSelect.val()){a.delegate.displayStatus("Saving preset ...");var t={};t.key=a.presetSelect.val(),a.presetDefaultCheckbox.is(":checked")&&(t.make_default=1),a.delegate.postAjax("ilab_imgix_save_preset",t,function(t){a.delegate.hideStatus()})}},this.deletePreset=function(){if(null!=a.presetSelect.val()&&confirm("Are you sure you want to delete this preset?")){a.delegate.displayStatus("Delete preset ...");var t={};t.key=a.presetSelect.val(),a.delegate.postAjax("ilab_imgix_delete_preset",t,function(t){a.delegate.hideStatus(),"ok"==t.status&&(a.delegate.settings.currentPreset=t.currentPreset,a.delegate.settings.presets=t.presets,a.init(),a.delegate.bindUI(t))})}},this.init()};!function(t){t.fn.ilabSidebarTabs=function(e){var i=t.extend({},e),a=!1;return this.find(".ilabm-sidebar-tab").each(function(){var e=t(this),s=i.container.find("."+e.data("target"));a||(e.addClass("active-tab"),s.removeClass("is-hidden"),a=!0),e.on("click",function(a){return a.preventDefault(),i.container.find(".ilabm-sidebar-tab").each(function(){var e=t(this),a=i.container.find("."+e.data("target"));e.removeClass("active-tab"),a.addClass("is-hidden")}),e.addClass("active-tab"),s.removeClass("is-hidden"),!1})})}}(jQuery);var ILabImageEdit=function(t,e){function i(){a.displayStatus("Building preview ..."),a.waitModal.removeClass("is-hidden"),a.postAjax("ilab_imgix_preview",{},function(t){if("ok"==t.status){var e=t.src==a.previewImage.attr("src"),i=!1;a.previewImage.on("load",function(){i=!0,a.waitModal.addClass("is-hidden"),a.hideStatus()}),a.previewImage.on("error",function(){i=!0,a.waitModal.addClass("is-hidden"),a.hideStatus()}),a.previewImage.attr("src",t.src),e&&setTimeout(function(){i||(a.waitModal.addClass("is-hidden"),a.hideStatus())},3e3)}else a.waitModal.addClass("is-hidden"),a.hideStatus()})}this.previewTimeout=null,this.previewsSuspended=!1,this.parameters=[];var a=this;this.settings=e,this.modalContainer=t("#ilabm-container-"+e.modal_id),this.waitModal=this.modalContainer.find(".ilabm-preview-wait-modal"),this.previewImage=this.modalContainer.find(".imgix-preview-image"),this.presets=new ILabImgixPresets(t,this,this.modalContainer),this.modalContainer.find(".imgix-button-reset-all").on("click",function(){a.resetAll()}),this.modalContainer.find(".imgix-button-save-adjustments").on("click",function(){a.apply()}),this.modalContainer.find(".imgix-parameter").each(function(){var e=t(this),i=e.data("param-type");"slider"==i?a.parameters.push(new ImgixComponents.ImgixSlider(a,e)):"color"==i||"blend-color"==i?a.parameters.push(new ImgixComponents.ImgixColor(a,e)):"pillbox"==i?a.parameters.push(new ImgixComponents.ImgixPillbox(a,e)):"media-chooser"==i?a.parameters.push(new ImgixComponents.ImgixMediaChooser(a,e)):"alignment"==i&&a.parameters.push(new ImgixComponents.ImgixAlignment(a,e))}),this.modalContainer.on("click",".imgix-pill",function(){var e=t(this).data("param"),i=a.modalContainer.find("#imgix-param-"+e);1==i.val()?(i.val(0),t(this).removeClass("pill-selected")):(i.val(1),t(this).addClass("pill-selected")),a.preview()}),this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:a.settings.size,tabSelected:function(t){ILabModal.loadURL(t.data("url"),!0,function(t){a.bindUI(t)})}}),this.modalContainer.find(".ilabm-sidebar-tabs").ilabSidebarTabs({delegate:this,container:this.modalContainer}),this.postAjax=function(e,i,s){var n={};a.parameters.forEach(function(t,e){n=t.saveValue(n)}),i.image_id=a.settings.image_id,i.action=e,i.size=a.settings.size,i.settings=n,t.post(ajaxurl,i,s)},this.preview=function(){a.previewsSuspended||(ILabModal.makeDirty(),clearTimeout(a.previewTimeout),a.previewTimeout=setTimeout(i,500))},this.bindUI=function(t){if(t.hasOwnProperty("currentPreset")&&null!=t.currentPreset&&""!=t.currentPreset){var e=a.settings.presets[t.currentPreset];a.presets.setCurrentPreset(t.currentPreset,e.default_for==t.size)}else a.presets.clearSelected();a.previewsSuspended=!0,a.settings.size=t.size,a.settings.settings=t.settings;var i=function(){a.previewImage.off("load",i),a.parameters.forEach(function(e,i){e.reset(t.settings)}),a.previewsSuspended=!1,ILabModal.makeClean()};t.src?(a.previewImage.on("load",i),a.previewImage.attr("src",t.src)):i()},this.bindPreset=function(t){a.previewsSuspended=!0,a.settings.settings=t.settings,a.previewImage.off("load"),a.parameters.forEach(function(t,e){t.reset(a.settings.settings)}),a.previewsSuspended=!1,a.preview()},this.apply=function(){a.displayStatus("Saving adjustments ..."),a.postAjax("ilab_imgix_save",{},function(t){a.hideStatus(),ILabModal.makeClean()})},this.resetAll=function(){a.parameters.forEach(function(t,e){t.reset()})},this.displayStatus=function(t){a.modalContainer.find(".ilabm-status-label").text(t),a.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){a.modalContainer.find(".ilabm-status-container").addClass("is-hidden")}};
//# sourceMappingURL=ilab-media-tools.js.map
