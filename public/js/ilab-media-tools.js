(function(e){'function'==typeof define&&define.amd?define(['jquery'],e):'object'==typeof exports?e(require('jquery')):e(jQuery)})(function(t){'use strict';function e(e){return'number'==typeof e&&!isNaN(e)}function i(e){return'undefined'==typeof e}function a(t,i){var a=[];return e(i)&&a.push(i),a.slice.apply(t,a)}function o(e,t){var i=a(arguments,2);return function(){return e.apply(t,i.concat(a(arguments)))}}function r(e){var t=e.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return t&&(t[1]!==C.protocol||t[2]!==C.hostname||t[3]!==C.port)}function n(e){var t='timestamp='+new Date().getTime();return e+(-1===e.indexOf('?')?'?':'&')+t}function s(e){return e?' crossOrigin="'+e+'"':''}function d(e,t){var i;return e.naturalWidth&&!me?t(e.naturalWidth,e.naturalHeight):void(i=document.createElement('img'),i.onload=function(){t(this.width,this.height)},i.src=e.src)}function l(t){var i=[],a=t.rotate,o=t.scaleX,r=t.scaleY;return e(o)&&e(r)&&i.push('scale('+o+','+r+')'),e(a)&&i.push('rotate('+a+'deg)'),i.length?i.join(' '):'none'}function p(e,t){var i,a,o=xe(e.degree)%180,r=(90<o?180-o:o)*x/180,n=we(r),s=be(r),d=e.width,l=e.height,p=e.aspectRatio;return t?(i=d/(s+n/p),a=i/p):(i=d*s+l*n,a=d*n+l*s),{width:i,height:a}}function c(i,a){var o,r,n,s=t('<canvas>')[0],d=s.getContext('2d'),l=0,c=0,h=a.naturalWidth,g=a.naturalHeight,m=a.rotate,u=a.scaleX,f=a.scaleY,v=e(u)&&e(f)&&(1!==u||1!==f),w=e(m)&&0!==m,b=w||v,C=h*xe(u||1),y=g*xe(f||1);return v&&(o=C/2,r=y/2),w&&(n=p({width:C,height:y,degree:m}),C=n.width,y=n.height,o=C/2,r=y/2),s.width=C,s.height=y,b&&(l=-h/2,c=-g/2,d.save(),d.translate(o,r)),v&&d.scale(u,f),w&&d.rotate(m*x/180),d.drawImage(i,Be(l),Be(c),Be(h),Be(g)),b&&d.restore(),s}function h(e){var i=e.length,a=0,o=0;return i&&(t.each(e,function(e,t){a+=t.pageX,o+=t.pageY}),a/=i,o/=i),{pageX:a,pageY:o}}function g(e,t,a){var o,i='';for(o=t,a+=t;o<a;o++)i+=De(e.getUint8(o));return i}function m(e){var t,a,o,r,n,s,d,l,p,c,i=new k(e),h=i.byteLength;if(255===i.getUint8(0)&&216===i.getUint8(1))for(p=2;p<h;){if(255===i.getUint8(p)&&225===i.getUint8(p+1)){d=p;break}p++}if(d&&(a=d+4,o=d+10,'Exif'===g(i,a,4)&&(s=i.getUint16(o),n=18761===s,(n||19789===s)&&42===i.getUint16(o+2,n)&&(r=i.getUint32(o+4,n),8<=r&&(l=o+r)))),l)for(h=i.getUint16(l,n),c=0;c<h;c++)if(p=l+12*c+2,274===i.getUint16(p,n)){p+=8,t=i.getUint16(p,n),me&&i.setUint16(p,1,n);break}return t}function u(e){var t,i=e.replace(J,''),a=atob(i),o=a.length,r=new B(o),n=new D(r);for(t=0;t<o;t++)n[t]=a.charCodeAt(t);return r}function f(e){var t,i=new D(e),a=i.length,o='';for(t=0;t<a;t++)o+=De(i[t]);return'data:image/jpeg;base64,'+S(o)}function v(e,i){this.$element=t(e),this.options=t.extend({},v.DEFAULTS,t.isPlainObject(i)&&i),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl='',this.canvas=null,this.cropBox=null,this.init()}var x=Math.PI,w=t(window),b=t(document),C=window.location,y=window.navigator,B=window.ArrayBuffer,D=window.Uint8Array,k=window.DataView,S=window.btoa,P='cropper',$='cropper-modal',_='cropper-hide',I='cropper-hidden',L='cropper-move',T='cropper-crop',O='cropper-disabled',W='mousedown touchstart pointerdown MSPointerDown',z='mousemove touchmove pointermove MSPointerMove',Y='mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel',X='wheel mousewheel DOMMouseScroll',M='dblclick',H='load.'+P,R='error.'+P,E='resize.'+P,U='build.'+P,A='built.'+P,V='cropstart.'+P,j='cropmove.'+P,F='cropend.'+P,N='crop.'+P,Z='zoom.'+P,q=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,K=/^data\:/,J=/^data\:([^\;]+)\;base64,/,Q=/^data\:image\/jpeg.*;base64,/,G='preview',ee='action',te='e',ie='w',ae='s',oe='n',re='se',ne='sw',se='ne',de='nw',le='all',pe='crop',ce='move',he='zoom',ge=t.isFunction(t('<canvas>')[0].getContext),me=y&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(y.userAgent),ue=Number,fe=Math.min,ve=Math.max,xe=Math.abs,we=Math.sin,be=Math.cos,Ce=Math.sqrt,ye=Math.round,Be=Math.floor,De=String.fromCharCode;v.prototype={constructor:v,init:function(){var e,t=this.$element;if(t.is('img')){if(this.isImg=!0,this.originalUrl=e=t.attr('src'),!e)return;e=t.prop('src')}else t.is('canvas')&&ge&&(e=t[0].toDataURL());this.load(e)},trigger:function(i,a){var o=t.Event(i,a);return this.$element.trigger(o),o},load:function(e){var i,a,o=this.options,s=this.$element;if(e)return(s.one(U,o.build),!this.trigger(U).isDefaultPrevented())?(this.url=e,this.image={},!o.checkOrientation||!B)?this.clone():(i=t.proxy(this.read,this),K.test(e)?Q.test(e)?i(u(e)):this.clone():void(a=new XMLHttpRequest,a.onerror=a.onabort=t.proxy(function(){this.clone()},this),a.onload=function(){i(this.response)},o.checkCrossOrigin&&r(e)&&s.prop('crossOrigin')&&(e=n(e)),a.open('get',e),a.responseType='arraybuffer',a.send())):void 0},read:function(e){var t,i,a,o=this.options,r=m(e),n=this.image;1<r&&(this.url=f(e),2===r?i=-1:3===r?t=-180:4===r?a=-1:5===r?(t=90,a=-1):6===r?t=90:7===r?(t=90,i=-1):8===r?t=-90:void 0);o.rotatable&&(n.rotate=t),o.scalable&&(n.scaleX=i,n.scaleY=a),this.clone()},clone:function(){var e,i,a=this.options,o=this.$element,d=this.url,l='';a.checkCrossOrigin&&r(d)&&(l=o.prop('crossOrigin'),l?e=d:(l='anonymous',e=n(d))),this.crossOrigin=l,this.crossOriginUrl=e,this.$clone=i=t('<img'+s(l)+' src="'+(e||d)+'">'),this.isImg?o[0].complete?this.start():o.one(H,t.proxy(this.start,this)):i.one(H,t.proxy(this.start,this)).one(R,t.proxy(this.stop,this)).addClass(_).insertAfter(o)},start:function(){var e=this.$element,i=this.$clone;this.isImg||(i.off(R,this.stop),e=i),d(e[0],t.proxy(function(e,i){t.extend(this.image,{naturalWidth:e,naturalHeight:i,aspectRatio:e/i}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var e,i,a,o=this.options,r=this.$element,n=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=r.parent(),this.$cropper=e=t(v.TEMPLATE),this.$canvas=e.find('.cropper-canvas').append(n),this.$dragBox=e.find('.cropper-drag-box'),this.$cropBox=i=e.find('.cropper-crop-box'),this.$viewBox=e.find('.cropper-view-box'),this.$face=a=i.find('.cropper-face'),r.addClass(I).after(e),!this.isImg&&n.removeClass(_),this.initPreview(),this.bind(),o.aspectRatio=ve(0,o.aspectRatio)||NaN,o.viewMode=ve(0,fe(3,ye(o.viewMode)))||0,o.autoCrop?(this.isCropped=!0,o.modal&&this.$dragBox.addClass($)):i.addClass(I),!o.guides&&i.find('.cropper-dashed').addClass(I),!o.center&&i.find('.cropper-center').addClass(I),o.cropBoxMovable&&a.addClass(L).data(ee,le),!o.highlight&&a.addClass('cropper-invisible'),o.background&&e.addClass('cropper-bg'),!o.cropBoxResizable&&i.find('.cropper-line, .cropper-point').addClass(I),this.setDragMode(o.dragMode),this.render(),this.isBuilt=!0,this.setData(o.data),r.one(A,o.built),setTimeout(t.proxy(function(){this.trigger(A),this.trigger(N,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var e=this.options,t=this.$element,i=this.$container,a=this.$cropper;a.addClass(I),t.removeClass(I),a.css(this.container={width:ve(i.width(),ue(e.minContainerWidth)||200),height:ve(i.height(),ue(e.minContainerHeight)||100)}),t.addClass(I),a.removeClass(I)},initCanvas:function(){var e,i=this.options.viewMode,a=this.container,o=a.width,r=a.height,n=this.image,s=n.naturalWidth,d=n.naturalHeight,l=90===xe(n.rotate),p=l?d:s,c=l?s:d,h=p/c,g=o,m=r;r*h>o?3===i?g=r*h:m=o/h:3===i?m=o/h:g=r*h,e={naturalWidth:p,naturalHeight:c,aspectRatio:h,width:g,height:m},e.oldLeft=e.left=(o-g)/2,e.oldTop=e.top=(r-m)/2,this.canvas=e,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=t.extend({},n),this.initialCanvas=t.extend({},e)},limitCanvas:function(e,t){var i,a,o,r,n=this.options,s=n.viewMode,d=this.container,l=d.width,p=d.height,c=this.canvas,h=c.aspectRatio,g=this.cropBox,m=this.isCropped&&g;e&&(i=ue(n.minCanvasWidth)||0,a=ue(n.minCanvasHeight)||0,s&&(1<s?(i=ve(i,l),a=ve(a,p),3===s&&(a*h>i?i=a*h:a=i/h)):i?i=ve(i,m?g.width:0):a?a=ve(a,m?g.height:0):m&&(i=g.width,a=g.height,a*h>i?i=a*h:a=i/h)),i&&a?a*h>i?a=i/h:i=a*h:i?a=i/h:a&&(i=a*h),c.minWidth=i,c.minHeight=a,c.maxWidth=Infinity,c.maxHeight=Infinity),t&&(s?(o=l-c.width,r=p-c.height,c.minLeft=fe(0,o),c.minTop=fe(0,r),c.maxLeft=ve(0,o),c.maxTop=ve(0,r),m&&this.isLimited&&(c.minLeft=fe(g.left,g.left+g.width-c.width),c.minTop=fe(g.top,g.top+g.height-c.height),c.maxLeft=g.left,c.maxTop=g.top,2===s&&(c.width>=l&&(c.minLeft=fe(0,o),c.maxLeft=ve(0,o)),c.height>=p&&(c.minTop=fe(0,r),c.maxTop=ve(0,r))))):(c.minLeft=-c.width,c.minTop=-c.height,c.maxLeft=l,c.maxTop=p))},renderCanvas:function(e){var t,i,a=this.canvas,o=this.image,r=o.rotate,n=o.naturalWidth,s=o.naturalHeight;this.isRotated&&(this.isRotated=!1,i=p({width:o.width,height:o.height,degree:r}),t=i.width/i.height,t!==a.aspectRatio&&(a.left-=(i.width-a.width)/2,a.top-=(i.height-a.height)/2,a.width=i.width,a.height=i.height,a.aspectRatio=t,a.naturalWidth=n,a.naturalHeight=s,r%180&&(i=p({width:n,height:s,degree:r}),a.naturalWidth=i.width,a.naturalHeight=i.height),this.limitCanvas(!0,!1))),(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=fe(ve(a.width,a.minWidth),a.maxWidth),a.height=fe(ve(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.oldLeft=a.left=fe(ve(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=fe(ve(a.top,a.minTop),a.maxTop),this.$canvas.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),e&&this.output()},renderImage:function(e){var i,a=this.canvas,o=this.image;o.rotate&&(i=p({width:a.width,height:a.height,degree:o.rotate,aspectRatio:o.aspectRatio},!0)),t.extend(o,i?{width:i.width,height:i.height,left:(a.width-i.width)/2,top:(a.height-i.height)/2}:{width:a.width,height:a.height,left:0,top:0}),this.$clone.css({width:o.width,height:o.height,marginLeft:o.left,marginTop:o.top,transform:l(o)}),e&&this.output()},initCropBox:function(){var e=this.options,i=this.canvas,a=e.aspectRatio,o=ue(e.autoCropArea)||0.8,r={width:i.width,height:i.height};a&&(i.height*a>i.width?r.height=r.width/a:r.width=r.height*a),this.cropBox=r,this.limitCropBox(!0,!0),r.width=fe(ve(r.width,r.minWidth),r.maxWidth),r.height=fe(ve(r.height,r.minHeight),r.maxHeight),r.width=ve(r.minWidth,r.width*o),r.height=ve(r.minHeight,r.height*o),r.oldLeft=r.left=i.left+(i.width-r.width)/2,r.oldTop=r.top=i.top+(i.height-r.height)/2,this.initialCropBox=t.extend({},r)},limitCropBox:function(e,t){var i,a,o,r,n=this.options,s=n.aspectRatio,d=this.container,l=d.width,p=d.height,c=this.canvas,h=this.cropBox,g=this.isLimited;e&&(i=ue(n.minCropBoxWidth)||0,a=ue(n.minCropBoxHeight)||0,i=fe(i,l),a=fe(a,p),o=fe(l,g?c.width:l),r=fe(p,g?c.height:p),s&&(i&&a?a*s>i?a=i/s:i=a*s:i?a=i/s:a&&(i=a*s),r*s>o?r=o/s:o=r*s),h.minWidth=fe(i,o),h.minHeight=fe(a,r),h.maxWidth=o,h.maxHeight=r),t&&(g?(h.minLeft=ve(0,c.left),h.minTop=ve(0,c.top),h.maxLeft=fe(l,c.left+c.width)-h.width,h.maxTop=fe(p,c.top+c.height)-h.height):(h.minLeft=0,h.minTop=0,h.maxLeft=l-h.width,h.maxTop=p-h.height))},renderCropBox:function(){var e=this.options,t=this.container,i=t.width,a=t.height,o=this.cropBox;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=fe(ve(o.width,o.minWidth),o.maxWidth),o.height=fe(ve(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.oldLeft=o.left=fe(ve(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=fe(ve(o.top,o.minTop),o.maxTop),e.movable&&e.cropBoxMovable&&this.$face.data(ee,o.width===i&&o.height===a?ce:le),this.$cropBox.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(N,this.getData())},initPreview:function(){var e,i=s(this.crossOrigin),a=i?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=e=t('<img'+i+' src="'+a+'">'),this.$viewBox.html(e),this.$preview.each(function(){var e=t(this);e.data(G,{width:e.width(),height:e.height(),html:e.html()}),e.html('<img'+i+' src="'+a+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var e=t(this),i=e.data(G);e.css({width:i.width,height:i.height}).html(i.html).removeData(G)})},preview:function(){var e=this.image,i=this.canvas,a=this.cropBox,o=a.width,r=a.height,n=e.width,s=e.height,d=a.left-i.left-e.left,p=a.top-i.top-e.top;!this.isCropped||this.isDisabled||(this.$clone2.css({width:n,height:s,marginLeft:-d,marginTop:-p,transform:l(e)}),this.$preview.each(function(){var i=t(this),a=i.data(G),c=a.width,h=a.height,g=c,m=h,u=1;o&&(u=c/o,m=r*u),r&&m>h&&(u=h/r,g=o*u,m=h),i.css({width:g,height:m}).find('img').css({width:n*u,height:s*u,marginLeft:-d*u,marginTop:-p*u,transform:l(e)})}))},bind:function(){var e=this.options,i=this.$element,a=this.$cropper;t.isFunction(e.cropstart)&&i.on(V,e.cropstart),t.isFunction(e.cropmove)&&i.on(j,e.cropmove),t.isFunction(e.cropend)&&i.on(F,e.cropend),t.isFunction(e.crop)&&i.on(N,e.crop),t.isFunction(e.zoom)&&i.on(Z,e.zoom),a.on(W,t.proxy(this.cropStart,this)),e.zoomable&&e.zoomOnWheel&&a.on(X,t.proxy(this.wheel,this)),e.toggleDragModeOnDblclick&&a.on(M,t.proxy(this.dblclick,this)),b.on(z,this._cropMove=o(this.cropMove,this)).on(Y,this._cropEnd=o(this.cropEnd,this)),e.responsive&&w.on(E,this._resize=o(this.resize,this))},unbind:function(){var e=this.options,i=this.$element,a=this.$cropper;t.isFunction(e.cropstart)&&i.off(V,e.cropstart),t.isFunction(e.cropmove)&&i.off(j,e.cropmove),t.isFunction(e.cropend)&&i.off(F,e.cropend),t.isFunction(e.crop)&&i.off(N,e.crop),t.isFunction(e.zoom)&&i.off(Z,e.zoom),a.off(W,this.cropStart),e.zoomable&&e.zoomOnWheel&&a.off(X,this.wheel),e.toggleDragModeOnDblclick&&a.off(M,this.dblclick),b.off(z,this._cropMove).off(Y,this._cropEnd),e.responsive&&w.off(E,this._resize)},resize:function(){var e,a,o,i=this.options.restore,r=this.$container,n=this.container;this.isDisabled||!n||(o=r.width()/n.width,(1!==o||r.height()!==n.height)&&(i&&(e=this.getCanvasData(),a=this.getCropBoxData()),this.render(),i&&(this.setCanvasData(t.each(e,function(t,i){e[t]=i*o})),this.setCropBoxData(t.each(a,function(e,t){a[e]=t*o})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(T)?this.setDragMode(ce):this.setDragMode(pe))},wheel:function(i){var a=i.originalEvent||i,e=ue(this.options.wheelZoomRatio)||0.1,o=1;this.isDisabled||(i.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),a.deltaY?o=0<a.deltaY?1:-1:a.wheelDelta?o=-a.wheelDelta/120:a.detail&&(o=0<a.detail?1:-1),this.zoom(-o*e,i)))},cropStart:function(i){var a,o,r=this.options,n=i.originalEvent,s=n&&n.touches,d=i;if(!this.isDisabled){if(s){if(a=s.length,1<a)if(r.zoomable&&r.zoomOnTouch&&2===a)d=s[1],this.startX2=d.pageX,this.startY2=d.pageY,o=he;else return;d=s[0]}if(o=o||t(d.target).data(ee),q.test(o)){if(this.trigger(V,{originalEvent:n,action:o}).isDefaultPrevented())return;i.preventDefault(),this.action=o,this.cropping=!1,this.startX=d.pageX||n&&n.pageX,this.startY=d.pageY||n&&n.pageY,o===pe&&(this.cropping=!0,this.$dragBox.addClass($))}}},cropMove:function(t){var i,a=this.options,o=t.originalEvent,r=o&&o.touches,n=t,e=this.action;if(!this.isDisabled){if(r){if(i=r.length,1<i)if(a.zoomable&&a.zoomOnTouch&&2===i)n=r[1],this.endX2=n.pageX,this.endY2=n.pageY;else return;n=r[0]}if(e){if(this.trigger(j,{originalEvent:o,action:e}).isDefaultPrevented())return;t.preventDefault(),this.endX=n.pageX||o&&o.pageX,this.endY=n.pageY||o&&o.pageY,this.change(n.shiftKey,e===he?t:null)}}},cropEnd:function(e){var t=e.originalEvent,i=this.action;this.isDisabled||i&&(e.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass($,this.isCropped&&this.options.modal)),this.action='',this.trigger(F,{originalEvent:t,action:i}))},change:function(e,t){var i,a,o=this.options,r=o.aspectRatio,n=this.action,s=this.container,d=this.canvas,l=this.cropBox,p=l.width,c=l.height,h=l.left,g=l.top,m=h+p,u=g+c,f=0,v=0,x=s.width,w=s.height,b=!0;switch(!r&&e&&(r=p&&c?p/c:1),this.isLimited&&(f=l.minLeft,v=l.minTop,x=f+fe(s.width,d.left+d.width),w=v+fe(s.height,d.top+d.height)),a={x:this.endX-this.startX,y:this.endY-this.startY},r&&(a.X=a.y*r,a.Y=a.x/r),n){case le:h+=a.x,g+=a.y;break;case te:if(0<=a.x&&(m>=x||r&&(g<=v||u>=w))){b=!1;break}p+=a.x,r&&(c=p/r,g-=a.Y/2),0>p&&(n=ie,p=0);break;case oe:if(0>=a.y&&(g<=v||r&&(h<=f||m>=x))){b=!1;break}c-=a.y,g+=a.y,r&&(p=c*r,h+=a.X/2),0>c&&(n=ae,c=0);break;case ie:if(0>=a.x&&(h<=f||r&&(g<=v||u>=w))){b=!1;break}p-=a.x,h+=a.x,r&&(c=p/r,g+=a.Y/2),0>p&&(n=te,p=0);break;case ae:if(0<=a.y&&(u>=w||r&&(h<=f||m>=x))){b=!1;break}c+=a.y,r&&(p=c*r,h-=a.X/2),0>c&&(n=oe,c=0);break;case se:if(r){if(0>=a.y&&(g<=v||m>=x)){b=!1;break}c-=a.y,g+=a.y,p=c*r}else 0<=a.x?m<x?p+=a.x:0>=a.y&&g<=v&&(b=!1):p+=a.x,0>=a.y?g>v&&(c-=a.y,g+=a.y):(c-=a.y,g+=a.y);0>p&&0>c?(n=ne,c=0,p=0):0>p?(n=de,p=0):0>c&&(n=re,c=0);break;case de:if(r){if(0>=a.y&&(g<=v||h<=f)){b=!1;break}c-=a.y,g+=a.y,p=c*r,h+=a.X}else 0>=a.x?h>f?(p-=a.x,h+=a.x):0>=a.y&&g<=v&&(b=!1):(p-=a.x,h+=a.x),0>=a.y?g>v&&(c-=a.y,g+=a.y):(c-=a.y,g+=a.y);0>p&&0>c?(n=re,c=0,p=0):0>p?(n=se,p=0):0>c&&(n=ne,c=0);break;case ne:if(r){if(0>=a.x&&(h<=f||u>=w)){b=!1;break}p-=a.x,h+=a.x,c=p/r}else 0>=a.x?h>f?(p-=a.x,h+=a.x):0<=a.y&&u>=w&&(b=!1):(p-=a.x,h+=a.x),0<=a.y?u<w&&(c+=a.y):c+=a.y;0>p&&0>c?(n=se,c=0,p=0):0>p?(n=re,p=0):0>c&&(n=de,c=0);break;case re:if(r){if(0<=a.x&&(m>=x||u>=w)){b=!1;break}p+=a.x,c=p/r}else 0<=a.x?m<x?p+=a.x:0<=a.y&&u>=w&&(b=!1):p+=a.x,0<=a.y?u<w&&(c+=a.y):c+=a.y;0>p&&0>c?(n=de,c=0,p=0):0>p?(n=ne,p=0):0>c&&(n=se,c=0);break;case ce:this.move(a.x,a.y),b=!1;break;case he:this.zoom(function(e,t,i,a){var o=Ce(e*e+t*t),r=Ce(i*i+a*a);return(r-o)/o}(xe(this.startX-this.startX2),xe(this.startY-this.startY2),xe(this.endX-this.endX2),xe(this.endY-this.endY2)),t),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case pe:if(!a.x||!a.y){b=!1;break}i=this.$cropper.offset(),h=this.startX-i.left,g=this.startY-i.top,p=l.minWidth,c=l.minHeight,0<a.x?n=0<a.y?re:se:0>a.x&&(h-=p,n=0<a.y?ne:de),0>a.y&&(g-=c),this.isCropped||(this.$cropBox.removeClass(I),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0));}b&&(l.width=p,l.height=c,l.left=h,l.top=g,this.action=n,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){!this.isBuilt||this.isDisabled||(!this.isCropped&&(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass($),this.$cropBox.removeClass(I)),this.setCropBoxData(this.initialCropBox))},reset:function(){!this.isBuilt||this.isDisabled||(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){!this.isCropped||this.isDisabled||(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass($),this.$cropBox.addClass(I))},replace:function(e,t){!this.isDisabled&&e&&(this.isImg&&this.$element.attr('src',e),t?(this.url=e,this.$clone.attr('src',e),this.isBuilt&&this.$preview.find('img').add(this.$clone2).attr('src',e)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(e)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(O))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(O))},destroy:function(){var e=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&e.attr('src',this.originalUrl),this.unbuild(),e.removeClass(I)):this.isImg?e.off(H,this.start):this.$clone&&this.$clone.remove(),e.removeData(P)},move:function(e,t){var a=this.canvas;this.moveTo(i(e)?e:a.left+ue(e),i(t)?t:a.top+ue(t))},moveTo:function(t,a){var o=this.canvas,r=!1;i(a)&&(a=t),t=ue(t),a=ue(a),this.isBuilt&&!this.isDisabled&&this.options.movable&&(e(t)&&(o.left=t,r=!0),e(a)&&(o.top=a,r=!0),r&&this.renderCanvas(!0))},zoom:function(e,t){var i=this.canvas;e=ue(e),e=0>e?1/(1-e):1+e,this.zoomTo(i.width*e/i.naturalWidth,t)},zoomTo:function(e,t){var i,a,o,r,n,s=this.options,d=this.canvas,l=d.width,p=d.height,c=d.naturalWidth,g=d.naturalHeight;if(e=ue(e),0<=e&&this.isBuilt&&!this.isDisabled&&s.zoomable){if(a=c*e,o=g*e,t&&(i=t.originalEvent),this.trigger(Z,{originalEvent:i,oldRatio:l/c,ratio:a/c}).isDefaultPrevented())return;i?(r=this.$cropper.offset(),n=i.touches?h(i.touches):{pageX:t.pageX||i.pageX||0,pageY:t.pageY||i.pageY||0},d.left-=(a-l)*((n.pageX-r.left-d.left)/l),d.top-=(o-p)*((n.pageY-r.top-d.top)/p)):(d.left-=(a-l)/2,d.top-=(o-p)/2),d.width=a,d.height=o,this.renderCanvas(!0)}},rotate:function(e){this.rotateTo((this.image.rotate||0)+ue(e))},rotateTo:function(t){t=ue(t),e(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,a){var o=this.image,r=!1;i(a)&&(a=t),t=ue(t),a=ue(a),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(e(t)&&(o.scaleX=t,r=!0),e(a)&&(o.scaleY=a,r=!0),r&&this.renderImage(!0))},scaleX:function(t){var i=this.image.scaleY;this.scale(t,e(i)?i:1)},scaleY:function(t){var i=this.image.scaleX;this.scale(e(i)?i:1,t)},getData:function(e){var a,o,i=this.options,r=this.image,n=this.canvas,s=this.cropBox;return this.isBuilt&&this.isCropped?(o={x:s.left-n.left,y:s.top-n.top,width:s.width,height:s.height},a=r.width/r.naturalWidth,t.each(o,function(t,i){i/=a,o[t]=e?ye(i):i})):o={x:0,y:0,width:0,height:0},i.rotatable&&(o.rotate=r.rotate||0),i.scalable&&(o.scaleX=r.scaleX||1,o.scaleY=r.scaleY||1),o},setData:function(i){var a,o,r,n=this.options,s=this.image,d=this.canvas,l={};t.isFunction(i)&&(i=i.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(i)&&(n.rotatable&&e(i.rotate)&&i.rotate!==s.rotate&&(s.rotate=i.rotate,this.isRotated=a=!0),n.scalable&&(e(i.scaleX)&&i.scaleX!==s.scaleX&&(s.scaleX=i.scaleX,o=!0),e(i.scaleY)&&i.scaleY!==s.scaleY&&(s.scaleY=i.scaleY,o=!0)),a?this.renderCanvas():o&&this.renderImage(),r=s.width/s.naturalWidth,e(i.x)&&(l.left=i.x*r+d.left),e(i.y)&&(l.top=i.y*r+d.top),e(i.width)&&(l.width=i.width*r),e(i.height)&&(l.height=i.height*r),this.setCropBoxData(l))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var e=this.canvas,a={};return this.isBuilt&&t.each(['left','top','width','height','naturalWidth','naturalHeight'],function(t,i){a[i]=e[i]}),a},setCanvasData:function(i){var a=this.canvas,o=a.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(i)&&(e(i.left)&&(a.left=i.left),e(i.top)&&(a.top=i.top),e(i.width)?(a.width=i.width,a.height=i.width/o):e(i.height)&&(a.height=i.height,a.width=i.height*o),this.renderCanvas(!0))},getCropBoxData:function(){var e,t=this.cropBox;return this.isBuilt&&this.isCropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(i){var a,o,r=this.cropBox,n=this.options.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(i)&&(e(i.left)&&(r.left=i.left),e(i.top)&&(r.top=i.top),e(i.width)&&(a=!0,r.width=i.width),e(i.height)&&(o=!0,r.height=i.height),n&&(a?r.height=r.width/n:o&&(r.width=r.height*n)),this.renderCropBox())},getCroppedCanvas:function(e){var i,a,o,r,n,s,d,l,p,h,g;if(this.isBuilt&&ge)return this.isCropped?(t.isPlainObject(e)||(e={}),g=this.getData(),i=g.width,a=g.height,l=i/a,t.isPlainObject(e)&&(n=e.width,s=e.height,n?(s=n/l,d=n/i):s&&(n=s*l,d=s/a)),o=Be(n||i),r=Be(s||a),p=t('<canvas>')[0],p.width=o,p.height=r,h=p.getContext('2d'),e.fillColor&&(h.fillStyle=e.fillColor,h.fillRect(0,0,o,r)),h.drawImage.apply(h,function(){var e,t,o,r,n,s,l=c(this.$clone[0],this.image),p=l.width,h=l.height,m=this.canvas,u=[l],f=g.x+m.naturalWidth*(xe(g.scaleX||1)-1)/2,v=g.y+m.naturalHeight*(xe(g.scaleY||1)-1)/2;return f<=-i||f>p?f=e=o=n=0:0>=f?(o=-f,f=0,e=n=fe(p,i+f)):f<=p&&(o=0,e=n=fe(i,p-f)),0>=e||v<=-a||v>h?v=t=r=s=0:0>=v?(r=-v,v=0,t=s=fe(h,a+v)):v<=h&&(r=0,t=s=fe(a,h-v)),u.push(Be(f),Be(v),Be(e),Be(t)),d&&(o*=d,r*=d,n*=d,s*=d),0<n&&0<s&&u.push(Be(o),Be(r),Be(n),Be(s)),u}.call(this)),p):c(this.$clone[0],this.image)},setAspectRatio:function(e){var t=this.options;this.isDisabled||i(e)||(t.aspectRatio=ve(0,e)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(e){var t,i,a=this.options;this.isLoaded&&!this.isDisabled&&(t=e===pe,i=a.movable&&e===ce,e=t||i?e:'none',this.$dragBox.data(ee,e).toggleClass(T,t).toggleClass(L,i),!a.cropBoxMovable&&this.$face.data(ee,e).toggleClass(T,t).toggleClass(L,i))}},v.DEFAULTS={viewMode:0,dragMode:'crop',aspectRatio:NaN,data:null,preview:'',responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:0.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:0.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},v.setDefaults=function(e){t.extend(v.DEFAULTS,e)},v.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',v.other=t.fn.cropper,t.fn.cropper=function(e){var o,r=a(arguments,1);return this.each(function(){var i,a,n=t(this),s=n.data(P);if(!s){if(/destroy/.test(e))return;i=t.extend({},n.data(),t.isPlainObject(e)&&e),n.data(P,s=new v(this,i))}'string'==typeof e&&t.isFunction(a=s[e])&&(o=a.apply(s,r))}),i(o)?this:o},t.fn.cropper.Constructor=v,t.fn.cropper.setDefaults=v.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=v.other,this}});var ILabCrop=function(e,t){this.settings=t,this.modalContainer=e('#ilabm-container-'+t.modal_id),this.cropper=this.modalContainer.find('.ilabc-cropper'),this.cropperData={},this.modal_id=t.modal_id;var i,a=this,o=!1;this.modalContainer.find('.ilabm-editor-tabs').ilabTabs({currentValue:this.settings.size,tabSelected:function(e){ILabModal.loadURL(e.data('url'),!0,function(e){a.bindUI(e)})}}),e(window).resize(function(){o||(data=a.cropper.cropper('getData'),a.settings.prev_crop_x=data.x,a.settings.prev_crop_y=data.y,a.settings.prev_crop_width=data.width,a.settings.prev_crop_height=data.height),o=!0,a.updatePreviewWidth(),clearTimeout(i),i=setTimeout(a._resized,250)}),this.modalContainer.find('.ilabc-button-crop').on('click',function(t){return t.preventDefault(),a.crop(),!1}),this._resized=function(){a.bindUI(a.settings),o=!1},this.updatePreviewWidth=function(){var e=this.modalContainer.find('.ilab-crop-preview-title').width();this.modalContainer.find('.ilab-crop-preview').css({height:e/a.settings.aspect_ratio+'px',width:e+'px'})},this.bindUI=function(e){this.settings=e,this.cropper.cropper('destroy'),this.cropper.off('built.cropper'),e.hasOwnProperty('cropped_src')&&null!==e.cropped_src&&this.modalContainer.find('.ilab-current-crop-img').attr('src',e.cropped_src),e.hasOwnProperty('size_title')&&null!==e.size_title&&this.modalContainer.find('.ilabc-crop-size-title').text('Current '+e.size_title+' ('+e.min_width+' x '+e.min_height+')'),'undefined'!=typeof e.aspect_ratio&&(this.updatePreviewWidth(),'undefined'!=typeof e.prev_crop_x&&null!==e.prev_crop_x&&(this.cropperData={x:e.prev_crop_x,y:e.prev_crop_y,width:e.prev_crop_width,height:e.prev_crop_height}),this.cropper.on('built.cropper',function(){a.updatePreviewWidth()}).on('crop.cropper',function(){}).cropper({viewMode:1,aspectRatio:e.aspect_ratio,minWidth:e.min_width,minHeight:e.min_height,modal:!0,zoomable:!1,mouseWheelZoom:!1,dragCrop:!1,autoCropArea:1,movable:!1,data:this.cropperData,checkImageOrigin:!1,checkCrossOrigin:!1,responsive:!0,preview:'#ilabm-container-'+this.modal_id+' .ilab-crop-preview'}))},this.crop=function(){var e=this;this.displayStatus('Saving crop ...');var t=this.cropper.cropper('getData');t.action='ilab_perform_crop',t.post=this.settings.image_id,t.size=this.settings.size,jQuery.post(ajaxurl,t,function(t){'ok'==t.status?(e.modalContainer.find('.ilab-current-crop-img').one('load',function(){e.hideStatus()}),e.modalContainer.find('.ilab-current-crop-img').attr('src',t.src)):e.hideStatus()})},this.displayStatus=function(e){a.modalContainer.find('.ilabm-status-label').text(e),a.modalContainer.find('.ilabm-status-container').removeClass('is-hidden')},this.hideStatus=function(){a.modalContainer.find('.ilabm-status-container').addClass('is-hidden')},this.bindUI(t)},ImgixComponents=function(){return{utilities:{byteToHex:function(e){var t=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];return t[15&e>>4]+t[15&e]}}}}();(function(e){e.fn.imgixLabel=function(t){var i=e.extend({},t);return this.each(function(){var t,a=e(this),o=0,r=e('<input type="text" class="imgix-label-editor is-hidden" pattern="[0-9-]+">');a.parent().append(r),r.on('keydown',function(t){if(27==t.keyCode)r.off('blur'),r.off('input'),r.addClass('is-hidden'),i.hasOwnProperty('changed')&&i.changed(o),a.text(o);else if(13==t.keyCode){r.off('blur'),r.off('input');var e=parseInt(r.val());r.addClass('is-hidden'),i.hasOwnProperty('changed')&&i.changed(e),a.text(e)}else if(38==t.keyCode){var e=parseInt(r.val());e++,r.val(e),i.hasOwnProperty('changed')&&i.changed(e),a.text(e)}else if(40==t.keyCode){var e=parseInt(r.val());e--,r.val(e),i.hasOwnProperty('changed')&&i.changed(e),a.text(e)}else return!!(57>t.keyCode)||90<t.keyCode&&105>t.keyCode||109==t.keyCode||!!t.metaKey||(t.preventDefault(),!1)}),a.on('click',function(n){return n.preventDefault(),r.on('input',function(){var e=parseInt(r.val());i.hasOwnProperty('changed')&&(clearTimeout(t),t=setTimeout(function(){i.changed(e)},500)),a.text(e)}),r.on('blur',function(){var e=parseInt(r.val());r.addClass('is-hidden'),i.hasOwnProperty('changed')&&i.changed(e),a.text(e)}),o=i.hasOwnProperty('currentValue')?i.currentValue():0,r.val(o),r.removeClass('is-hidden'),r.select(),r.focus(),!1})})}})(jQuery),function(){ImgixComponents.ImgixSlider=function(e,t){this.delegate=e,this.container=t,this.valueLabel=t.find('.imgix-param-title-right > h3'),this.slider=t.find('.imgix-param'),this.resetButton=t.find('.imgix-param-reset'),this.defaultValue=t.data('default-value'),this.param=t.data('param');var i=this;this.container.find('.imgix-param-label').imgixLabel({currentValue:function(){return i.slider.val()},changed:function(e){e==i.slider.val()||(i.slider.val(e),i.slider.hide().show(0),i.delegate.preview())}}),this.resetButton.on('click',function(){i.reset()}),this.slider.on('input',function(){i.valueLabel.text(i.slider.val())}),this.slider.on('change',function(){i.valueLabel.text(i.slider.val()),i.delegate.preview()})},ImgixComponents.ImgixSlider.prototype.destroy=function(){this.slider.off('input'),this.slider.off('change'),this.resetButton.off('click')},ImgixComponents.ImgixSlider.prototype.reset=function(e){var t;t=e&&e.hasOwnProperty(this.param)?e[this.param]:this.defaultValue,this.valueLabel.text(t),this.slider.val(t),this.slider.hide().show(0),this.delegate.preview()},ImgixComponents.ImgixSlider.prototype.saveValue=function(e){return this.slider.val()!=this.defaultValue&&(e[this.param]=this.slider.val()),e}}(jQuery),function(){var e=Math.round;ImgixComponents.ImgixColor=function(e,t){this.delegate=e,this.container=t,this.colorPicker=t.find('.imgix-param-color'),this.alphaSlider=t.find('.imgix-param-alpha'),this.type=t.data('param-type'),this.resetButton=t.find('.imgix-param-reset'),this.param=t.data('param'),this.defaultValue=t.data('default-value');var i=this;if('blend-color'==this.type){this.blendParam=t.data('blend-param'),this.blendSelect=t.find('.imgix-param-blend');var a=t.data('blend-value');this.blendSelect.val(a),this.blendSelect.on('change',function(){i.delegate.preview()})}this.colorPicker.wpColorPicker({palettes:!1,change:function(){i.delegate.preview()}}),this.alphaSlider.on('change',function(){i.delegate.preview()}),this.resetButton.on('click',function(){i.reset()})},ImgixComponents.ImgixColor.prototype.destroy=function(){this.alphaSlider.off('change'),'blend-color'==this.type&&this.blendSelect.off('change'),this.resetButton.off('click')},ImgixComponents.ImgixColor.prototype.reset=function(t){var i,a='none';if(void 0!==t&&t.hasOwnProperty(this.blendParam)&&(a=t[this.blendParam]),i=void 0!==t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,i=i.replace('#',''),8==i.length){var o=100*(parseInt('0x'+i.substring(0,2))/255);i=i.substring(2),this.alphaSlider.val(e(o)),this.alphaSlider.hide().show(0)}else this.alphaSlider.val(0),this.alphaSlider.hide().show(0);this.colorPicker.val('#'+i),this.colorPicker.wpColorPicker('color','#'+i),'blend-color'==this.type&&this.blendSelect.val(a),this.delegate.preview()},ImgixComponents.ImgixColor.prototype.saveValue=function(t){return 0<this.alphaSlider.val()&&(t[this.param]='#'+ImgixComponents.utilities.byteToHex(e(255*(parseFloat(this.alphaSlider.val())/100)))+this.colorPicker.val().replace('#',''),'blend-color'==this.type&&'none'!=this.blendSelect.val()&&(t[this.blendParam]=this.blendSelect.val())),t}}(jQuery),function(e){ImgixComponents.ImgixAlignment=function(t,i){this.delegate=t,this.container=i,this.alignmentParam=i.find('.imgix-param'),this.resetButton=i.find('.imgix-param-reset'),this.defaultValue=i.data('default-value'),this.param=i.data('param');var a=this;this.resetButton.on('click',function(){a.reset()}),i.find('.imgix-alignment-button').on('click',function(){var t=e(this);a.container.find('.imgix-alignment-button').each(function(){e(this).removeClass('selected-alignment')}),t.addClass('selected-alignment'),a.alignmentParam.val(t.data('param-value')),a.delegate.preview()})},ImgixComponents.ImgixAlignment.prototype.destroy=function(){this.resetButton.off('click'),this.container.find('.imgix-alignment-button').off('click')},ImgixComponents.ImgixAlignment.prototype.reset=function(t){var i;i=t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,''==i&&(i=this.defaultValue),this.container.find('.imgix-alignment-button').each(function(){var t=e(this);t.data('param-value')==i?t.addClass('selected-alignment'):t.removeClass('selected-alignment')}),this.alignmentParam.val(i),this.delegate.preview()},ImgixComponents.ImgixAlignment.prototype.saveValue=function(e){return this.alignmentParam.val()!=this.defaultValue&&(e[this.param]=this.alignmentParam.val()),e}}(jQuery),function(){ImgixComponents.ImgixMediaChooser=function(e,t){this.delegate=e,this.container=t,this.preview=t.find('.imgix-media-preview img'),this.mediaInput=t.find('.imgix-param'),this.selectButton=t.find('.imgix-media-button'),this.resetButton=t.find('.imgix-param-reset'),this.defaultValue=t.data('default-value'),this.param=t.data('param'),this.uploader=wp.media({title:'Select Watermark',button:{text:'Select Watermark'},multiple:!1});var i=this;this.resetButton.on('click',function(){i.reset()}),this.uploader.on('select',function(){attachment=i.uploader.state().get('selection').first().toJSON(),i.mediaInput.val(attachment.id),i.preview.attr('src',attachment.url),i.delegate.preview()}),this.selectButton.on('click',function(t){return t.preventDefault(),i.uploader.open(),!1})},ImgixComponents.ImgixMediaChooser.prototype.destroy=function(){this.selectButton.off('click'),this.uploader.off('select'),this.resetButton.off('click')},ImgixComponents.ImgixMediaChooser.prototype.reset=function(e){var t;e&&e.hasOwnProperty(this.param)?(t=e[this.param],this.mediaInput.val(t)):this.mediaInput.val(''),e&&e.hasOwnProperty(this.param+'_url')?this.preview.attr('src',e[this.param+'_url']):(this.preview.removeAttr('src').replaceWith(this.preview.clone()),this.preview=this.container.find('.imgix-media-preview img')),this.delegate.preview()},ImgixComponents.ImgixMediaChooser.prototype.saveValue=function(e){var t=this.mediaInput.val();return t&&''!=t&&(e[this.param]=t),e}}(jQuery),function(e){ImgixComponents.ImgixPillbox=function(t,i){this.delegate=t,this.container=i,this.param=i.data('param'),this.values=i.data('param-values').split(','),this.buttons=i.find('.ilabm-pill'),this.inputs={};var a=this;this.buttons.each(function(){var t=e(this),i=t.data('param');a.inputs[i]=a.container.find('input[name=\''+i+'\']'),t.on('click',function(o){return o.preventDefault(),0==a.inputs[i].val()?(a.inputs[i].val(1),t.addClass('pill-selected')):(a.inputs[i].val(0),t.removeClass('pill-selected')),a.delegate.preview(),!1})})},ImgixComponents.ImgixPillbox.prototype.destroy=function(){this.buttons.off('click')},ImgixComponents.ImgixPillbox.prototype.reset=function(t){this.buttons.each(function(){e(this).removeClass('pill-selected')});var i=this;if(Object.keys(this.inputs).forEach(function(e){i.inputs[e].val(0)}),t&&t.hasOwnProperty(this.param)){var a=t[this.param].split(',');a.forEach(function(e){i.inputs[e].val(1),i.container.find('imgix-pill-'+e).addClass('pill-selected')})}this.delegate.preview()},ImgixComponents.ImgixPillbox.prototype.saveValue=function(e){var t=[],i=this;return Object.keys(this.inputs).forEach(function(e){1==i.inputs[e].val()&&t.push(e)}),0<t.length&&(e[this.param]=t.join(',')),e}}(jQuery);var ILabImgixPresets=function(e,t,i){this.delegate=t,this.container=i.find('.ilabm-bottom-bar'),this.presetSelect=this.container.find('.imgix-presets'),this.presetContainer=this.container.find('.imgix-preset-container'),this.presetDefaultCheckbox=this.container.find('.imgix-preset-make-default');var a=this;a.presetSelect.on('change',function(){if(0==a.presetSelect.val)return a.delegate.resetAll(),void a.presetDefaultCheckbox.prop('checked',!1);var e=a.delegate.settings.presets[a.presetSelect.val()];e.default_for==a.delegate.settings.size&&a.presetDefaultCheckbox.prop('checked',!0),a.delegate.bindPreset(e)}),this.container.find('.imgix-new-preset-button').on('click',function(){a.newPreset()}),this.container.find('.imgix-save-preset-button').on('click',function(){a.savePreset()}),this.container.find('.imgix-delete-preset-button').on('click',function(){a.deletePreset()}),this.init=function(){a.presetSelect.find('option').remove(),0==Object.keys(a.delegate.settings.presets).length?a.presetContainer.addClass('is-hidden'):(Object.keys(a.delegate.settings.presets).forEach(function(t){a.presetSelect.append(e('<option></option>').attr('value','0').text('None')),a.presetSelect.append(e('<option></option>').attr('value',t).text(a.delegate.settings.presets[t].title))}),a.presetContainer.removeClass('is-hidden'),a.presetSelect.val(a.delegate.settings.currentPreset))},this.clearSelected=function(){a.presetSelect.val(0),a.presetDefaultCheckbox.prop('checked',!1)},this.setCurrentPreset=function(e,t){t?a.presetDefaultCheckbox.prop('checked',!0):a.presetDefaultCheckbox.prop('checked',!1),a.presetSelect.val(e)},this.newPreset=function(){var e=prompt('New preset name');if(null!=e){a.delegate.displayStatus('Saving preset ...');var t={};t.name=e,a.presetDefaultCheckbox.is(':checked')&&(t.make_default=1),a.delegate.postAjax('ilab_imgix_new_preset',t,function(e){a.delegate.hideStatus(),'ok'==e.status&&(a.delegate.settings.currentPreset=e.currentPreset,a.delegate.settings.presets=e.presets,a.init())})}},this.savePreset=function(){if(null!=a.presetSelect.val()){a.delegate.displayStatus('Saving preset ...');var e={};e.key=a.presetSelect.val(),a.presetDefaultCheckbox.is(':checked')&&(e.make_default=1),a.delegate.postAjax('ilab_imgix_save_preset',e,function(){a.delegate.hideStatus()})}},this.deletePreset=function(){if(null!=a.presetSelect.val()&&confirm('Are you sure you want to delete this preset?')){a.delegate.displayStatus('Delete preset ...');var e={};e.key=a.presetSelect.val(),a.delegate.postAjax('ilab_imgix_delete_preset',e,function(e){a.delegate.hideStatus(),'ok'==e.status&&(a.delegate.settings.currentPreset=e.currentPreset,a.delegate.settings.presets=e.presets,a.init(),a.delegate.bindUI(e))})}},this.init()};(function(e){e.fn.ilabSidebarTabs=function(t){var i=e.extend({},t),a=!1;return this.find('.ilabm-sidebar-tab').each(function(){var t=e(this),o=i.container.find('.'+t.data('target'));a||(t.addClass('active-tab'),o.removeClass('is-hidden'),a=!0),t.on('click',function(a){return a.preventDefault(),i.container.find('.ilabm-sidebar-tab').each(function(){var t=e(this),a=i.container.find('.'+t.data('target'));t.removeClass('active-tab'),a.addClass('is-hidden')}),t.addClass('active-tab'),o.removeClass('is-hidden'),!1})})}})(jQuery);var ILabImageEdit=function(e,t){function i(){a.displayStatus('Building preview ...'),a.waitModal.removeClass('is-hidden'),a.postAjax('ilab_imgix_preview',{},function(e){if('ok'==e.status){var t=e.src==a.previewImage.attr('src'),i=!1;a.previewImage.on('load',function(){i=!0,a.waitModal.addClass('is-hidden'),a.hideStatus()}),a.previewImage.on('error',function(){i=!0,a.waitModal.addClass('is-hidden'),a.hideStatus()}),a.previewImage.attr('src',e.src),t&&setTimeout(function(){i||(a.waitModal.addClass('is-hidden'),a.hideStatus())},3e3)}else a.waitModal.addClass('is-hidden'),a.hideStatus()})}this.previewTimeout=null,this.previewsSuspended=!1,this.parameters=[];var a=this;this.settings=t,this.modalContainer=e('#ilabm-container-'+t.modal_id),this.waitModal=this.modalContainer.find('.ilabm-preview-wait-modal'),this.previewImage=this.modalContainer.find('.imgix-preview-image'),this.presets=new ILabImgixPresets(e,this,this.modalContainer),this.modalContainer.find('.imgix-button-reset-all').on('click',function(){a.resetAll()}),this.modalContainer.find('.imgix-button-save-adjustments').on('click',function(){a.apply()}),this.modalContainer.find('.imgix-parameter').each(function(){var t=e(this),i=t.data('param-type');'slider'==i?a.parameters.push(new ImgixComponents.ImgixSlider(a,t)):'color'==i||'blend-color'==i?a.parameters.push(new ImgixComponents.ImgixColor(a,t)):'pillbox'==i?a.parameters.push(new ImgixComponents.ImgixPillbox(a,t)):'media-chooser'==i?a.parameters.push(new ImgixComponents.ImgixMediaChooser(a,t)):'alignment'==i&&a.parameters.push(new ImgixComponents.ImgixAlignment(a,t))}),this.modalContainer.on('click','.imgix-pill',function(){var t=e(this).data('param'),i=a.modalContainer.find('#imgix-param-'+t);1==i.val()?(i.val(0),e(this).removeClass('pill-selected')):(i.val(1),e(this).addClass('pill-selected')),a.preview()}),this.modalContainer.find('.ilabm-editor-tabs').ilabTabs({currentValue:a.settings.size,tabSelected:function(e){ILabModal.loadURL(e.data('url'),!0,function(e){a.bindUI(e)})}}),this.modalContainer.find('.ilabm-sidebar-tabs').ilabSidebarTabs({delegate:this,container:this.modalContainer}),this.postAjax=function(t,i,o){var r={};a.parameters.forEach(function(e){r=e.saveValue(r)}),i.image_id=a.settings.image_id,i.action=t,i.size=a.settings.size,i.settings=r,e.post(ajaxurl,i,o)},this.preview=function(){a.previewsSuspended||(ILabModal.makeDirty(),clearTimeout(a.previewTimeout),a.previewTimeout=setTimeout(i,500))},this.bindUI=function(e){if(e.hasOwnProperty('currentPreset')&&null!=e.currentPreset&&''!=e.currentPreset){var t=a.settings.presets[e.currentPreset];a.presets.setCurrentPreset(e.currentPreset,t.default_for==e.size)}else a.presets.clearSelected();a.previewsSuspended=!0,a.settings.size=e.size,a.settings.settings=e.settings;var i=function(){a.previewImage.off('load',i),a.parameters.forEach(function(t){t.reset(e.settings)}),a.previewsSuspended=!1,ILabModal.makeClean()};e.src?(a.previewImage.on('load',i),a.previewImage.attr('src',e.src)):i()},this.bindPreset=function(e){a.previewsSuspended=!0,a.settings.settings=e.settings,a.previewImage.off('load'),a.parameters.forEach(function(e){e.reset(a.settings.settings)}),a.previewsSuspended=!1,a.preview()},this.apply=function(){a.displayStatus('Saving adjustments ...'),a.postAjax('ilab_imgix_save',{},function(){a.hideStatus(),ILabModal.makeClean()})},this.resetAll=function(){a.parameters.forEach(function(e){e.reset()})},this.displayStatus=function(e){a.modalContainer.find('.ilabm-status-label').text(e),a.modalContainer.find('.ilabm-status-container').removeClass('is-hidden')},this.hideStatus=function(){a.modalContainer.find('.ilabm-status-container').addClass('is-hidden')}};