{"version":3,"sources":["ilab-media-upload-s3.js"],"names":[],"mappings":"AAAA,uCACA,sBACA,SACA,KACA,iCACA,AACA,AACA,mBACA,QACA,iCACA,KACA,AACA,AACA,oCACA,sBACA,oBACA,AACA,0BACA,oDACA,CACA,uBACA,AACA,YACA,AACA,yBACA,oDACA,AACA,AACA,cACA,sCACA,AACA,AACA,kBACA,mCACA,sBACA,cACA,AACA,AACA,iBACA,OACA,WACA,OACA,eACA,eACA,qBACA,sBACA,MAIA,sCAHA,6BACA,MACA,GAEA,oBACA,OACA,QACA,sCACA,AACA,AACA,iCACA,gBACA,sBACA,EACA,kBACA,GACA,iBACA,AACA,GACA,QACA,AACA,iBACA,AACA,EACA,CACA,EACA","file":"ilab-media-upload-s3.js","sourcesContent":["var ilabMediaS3Uploader = function($, item, file) {\n    this.start = function() {\n        var mimeType = file.type;\n        if (mimeType == 'application/x-photoshop') {\n            mimeType = 'image/psd';\n        }\n\n        var data = {\n            \"action\": \"ilab_upload_prepare\",\n            \"filename\": file.name,\n            \"type\": mimeType\n        };\n\n        $.post(ajaxurl, data, function(response){\n            if (response.status == 'ready') {\n                item.updateStatusText('Uploading ...');\n\n                var data = new FormData();\n                _.each(Object.keys(response.formData), function(key){\n                    if (key != 'key') {\n                        data.append(key, response.formData[key]);\n                    }\n                });\n\n                if ((response.cacheControl != null) && (response.cacheControl.length > 0)) {\n                    data.append('Cache-Control', response.cacheControl);\n                }\n\n                if (response.expires != null) {\n                    data.append('Expires', response.expires);\n                }\n\n                data.append('Content-Type', mimeType);\n                data.append('acl',response.acl);\n                data.append('key',response.key);\n                data.append('file',file);\n\n\n                $.ajax({\n                    url: response.url,\n                    method: 'POST',\n                    contentType: false,\n                    processData: false,\n                    data:data,\n                    xhr: function() {\n                        var xhr = $.ajaxSettings.xhr();\n                        xhr.upload.onprogress = function (e) {\n                            item.updateProgress(e.loaded / e.total);\n                        };\n                        return xhr;\n                    },\n                    success: function(successResponse) {\n                        var importData = {\n                            \"action\": \"ilab_upload_import_cloud_file\",\n                            \"key\": response.key\n                        };\n\n                        $.post(ajaxurl, importData, function(importResponse) {\n                            item.itemUploaded((importResponse.status == 'success'), importResponse);\n                        });\n                    },\n                    error: function(response) {\n                        item.itemUploadError();\n                    }\n                })\n            } else {\n                item.itemUploadError();\n            }\n        });\n\n    }\n};\n\nilabMediaUploadItem.prototype.storageUploader = ilabMediaS3Uploader;"],"sourceRoot":"js/"}